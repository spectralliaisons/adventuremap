{"version":3,"sources":["Menu.js","Legend.js","Marker.js","MapStyleControl.js","S3.js","Map.js","custom/Config.js","App.js","index.js"],"names":["_","require","Hamburger","menuState","toggle","label","id","className","onClick","title","Places","places","placesLs","chain","keys","map","pID","o","disp","loaded","sortBy","value","p","Item","href","Menu","setMenuState","useState","size","Point","color","width","r","cx","cy","fill","Line","x1","x2","y1","y2","stroke","Legend","available","visible","colorRiver","colorTrack","setVisibility","which","styledMarker","location","marker","document","createElement","link","textContent","icon","aud","img","Window","s3rsc","place","showLocations","linkImgSrc","src","linkDestination","destination","linkText","text","imgDestination","imgSrc","date","split","replaceAll","Location","Image","ExternalLink","Sound","ExternalVideo","video","lat","loc","toFixed","lng","url","target","rel","ImageContent","formatted","alt","controls","type","height","frameBorder","allow","referrerPolicy","allowFullScreen","MapStyleControl","options","setStyleCb","state","setState","style","setStyle","useEffect","styleLabel","name","MapBoxControl","constructor","this","container","component","onAdd","render","onRemove","parentNode","removeChild","undefined","ReactDOM","_cache","_filter_local_places","window","host","local","Error","message","Desc","html","dangerouslySetInnerHTML","__html","Modal","close","Map","config","mapboxgl","accessToken","loadPlace","fetchPlaces","s3","where","bucketUrl","Date","getTime","_fetchJSON","fetch","then","res","ok","json","Promise","reject","dat","filter","i","extend","reduce","acc","resolve","paintData","each","layers","layer","paint","fetchPlacesRef","useRef","mapStylesRef","mapStyles","hoveredFtRef","selectedFtRef","mapContainerRef","attributionRef","attribution","centerRef","center","zoomRef","zoom","showLocationsRef","geolocationRef","geolocation","circleRadiusRef","circleRadius","circleStrokeWidthRef","circleStrokeWidth","circleStrokeColorRef","circleStrokeColor","colorWaterMarkerRef","colorWaterMarker","colorNonWaterMarkerRef","colorNonWaterMarker","colorPolyFillRef","colorPolyFill","colorRiverRef","colorTrackRef","paintPolyRef","paintPoly","paintTrackRef","paintTrack","paintRiversSmRef","paintRiversSm","paintRiversLgRef","paintRiversLg","legendRef","legend","mapData","setPlaces","legendVisible","setLegendVisible","error","setError","modalHtml","setModalHtml","desc","setDesc","paintPlaceRef","initialPlaces","addPoints","lID0","kinds","isWaterMarker","indexOf","lID1","current","addLayer","addListeners","lID","on","drawTooltip","drawDescription","fire","lngLat","features","length","content","properties","description","ft","geometry","coordinates","wrap","remove","coord","el","Popup","offset","setLngLat","setDOMContent","addTo","addPolys","addLines","isTrack","isSmRiver","data","addSource","replace","prev0","prev1","locations","popup","closeOnClick","Marker","setPopup","ReactDomServer","renderToString","paintMarker","pos","findWhere","flyTo","catch","err","console","log","s","setHTML","attributionControl","projection","addControl","AttributionControl","compact","customAttribution","FullscreenControl","querySelector","NavigationControl","once","doLoad","curr","hash","onhashchange","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","showUserHeading","ref","site","getFullYear","App","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.fa2e8d1b.chunk.js","sourcesContent":["import React, {useState} from 'react';\nimport './Menu.scss';\nlet _ = require('underscore');\n\nconst Menu = ({places}) => {\n\n    const [menuState, setMenuState] = useState(\"loading\");\n\n    if (menuState === \"loading\" && _.size(places) > 0) {setMenuState(\"open\");}\n\n    function toggle() {\n        if (menuState === \"open\") {setMenuState(\"closed\");} \n        else {setMenuState(\"open\");}\n    }\n\n    return (\n        <div id='menu' className={menuState}>\n            <Hamburger menuState={menuState} toggle={toggle}/>\n            <Places menuState={menuState} places={places} />\n        </div>\n    );\n};\n\nconst Hamburger = ({menuState, toggle}) => {\n    const label = `${menuState === \"open\" ? \"Close\" : \"Open\"} map navigation menu.`;\n    return (\n        <button id=\"hamburger\" className={menuState} onClick={toggle} title={label} aria-label={label}>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </button>\n    )\n};\n\nconst Places = ({menuState, places}) => {\n    const placesLs = _.chain(places)\n        .keys()\n        .map(pID => {\n            const o = places[pID];\n            return {id:pID, disp:o.disp, className:o.loaded ? \"loaded\" : \"unloaded\"};\n        })\n        .sortBy(\"disp\")\n        .value();\n    return (\n        <div id=\"places\" className={menuState}>\n            <ol>{placesLs.map(p => \n                <div key={p.id}>\n                    <Item id={p.id} className={p.className} disp={p.disp} />\n                </div>\n            )}</ol>\n        </div>\n    )\n};\n\nconst Item = ({id, className, disp}) => {\n    const label = `Show map of ${disp}.`;\n    return (\n        <li id={id} className={className}><a href={\"#\"+id} title={label} aria-label={label}>{disp}</a></li>\n    );\n};\n\nexport default Menu;\n","import React from 'react';\nimport './Legend.scss';\n\nconst Legend = ({available, visible, colorRiver, colorTrack}) => {\n    if (visible) {\n        const setVisibility = (which) => `item ${available[which] === false ? 'unavailable' : ''}`;\n        return (\n            <div id=\"legend\">\n                <div className={setVisibility(\"aud\")}>\n                    <div id=\"eg-aud\" className=\"eg-marker\"/>\n                    <span>sound</span>\n                </div>\n                <div className={setVisibility(\"img\")}>\n                    <div id=\"eg-img\" className=\"eg-marker\"/>\n                    <span>photo</span>\n                </div>\n                <div className={setVisibility(\"water\")}>\n                    <Point color={colorRiver}/>\n                    <span>water feature</span>\n                </div>\n                <div className={setVisibility(\"human\")}>\n                    <Point color={colorTrack}/>\n                    <span>human feature</span>\n                </div>\n                <div className={setVisibility(\"other\")}>\n                    <Point color={\"#000000\"}/>\n                    <span>other feature</span>\n                </div>\n                <div className={setVisibility(\"river\")}>\n                    <Line color={colorRiver}/>\n                    <span>river</span>\n                </div>\n                <div className={setVisibility(\"route\")}>\n                    <Line color={colorTrack}/>\n                    <span>my route</span>\n                </div>\n            </div>\n        )\n    }\n    else {\n        return <div></div>\n    }\n};\n\nconst Point = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <circle r=\"5\" cx=\"13\" cy=\"13\" fill={color}></circle>\n        </svg>\n    )\n};\n\nconst Line = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <line x1=\"0\" x2=\"25\" y1=\"13\" y2=\"13\" stroke={color}></line>\n        </svg>\n    )\n};\n\nexport default Legend;","import ReactDomServer from 'react-dom/server'\nimport mapboxgl from 'mapbox-gl';\nimport 'material-icons/iconfont/material-icons.css';\n\nconst paintMarker = (s3rsc, map, place, setModalHtml, showLocations) => location => {\n  const el = document.createElement('div');\n\n  const popup = new mapboxgl.Popup({ \n    className: 'media', \n    closeOnClick: true,\n    offset: 25 \n  }).setDOMContent(el);\n\n  const loc = [location.loc.lng, location.loc.lat];\n\n  new mapboxgl.Marker(styledMarker(location))\n    .setLngLat(loc)\n    .setPopup(popup)\n    .addTo(map);\n\n  const html = ReactDomServer.renderToString(<Window s3rsc={s3rsc} place={place} location={location} showLocations={showLocations}/>);\n  popup.on('open', () => setModalHtml({loc, html:html}));\n};\n\nconst styledMarker = location => {\n  let marker = document.createElement('div');\n  if (location.link != null) {\n    marker.className = 'material-icons marker-link';\n    marker.textContent = location.link.icon;\n  }\n  else if (location.aud != null) {marker.className = 'marker-aud';}\n  else if (location.img != null) {marker.className = 'marker-img';}\n  return marker;\n};\n\nconst Window = ({s3rsc, place, location, showLocations}) => {\n  const label = location.label || \"\";\n  const linkImgSrc = location.link ? location.link.src : null;\n  const linkDestination = location.link ? location.link.destination : null;\n  const linkText = location.link ? location.link.text : null;\n  const imgDestination = location.img ? s3rsc(`${place}/imgLg/${location.img}`) : null;\n  const imgSrc = location.img ? s3rsc(`${place}/imgSm/${location.img}`) : linkImgSrc;\n  const date = location.date ? location.date.split(\" \")[0].replaceAll(\":\", \".\") : null;\n  return (\n      <div>\n        <Location visible={showLocations} location={location}/>\n        <h3>{label}</h3>\n        <div className=\"center\">\n          <div>\n            <Image destination={imgDestination} imgSrc={imgSrc} label={label} date={date}/>\n            <ExternalLink destination={linkDestination} text={linkText}/>\n          </div>\n        </div>\n        <Sound s3rsc={s3rsc} place={place} src={location.aud}/>\n        <ExternalVideo src={location.video}/>\n      </div>\n  );\n};\n\nconst Location = ({location, visible}) => {\n  if (!visible) return <div></div>\n  else {\n    const lat = location.loc.lat.toFixed(4);\n    const lng = location.loc.lng.toFixed(4);\n    const url = `https://www.google.com/maps/search/?api=1&query=${location.loc.lat},${location.loc.lng}`;\n    return <div className=\"icon\"><span className=\"material-icons\">map</span><a href={url} target=\"_\">{lat},{lng}</a></div>\n  }\n};\n\nconst Image = ({destination, imgSrc, label, date}) => {\n  return (\n    <a href={destination} target=\"_blank\" rel=\"noreferrer\">\n      <ImageContent destination={destination} imgSrc={imgSrc} label={label} date={date} />\n    </a>\n  )\n};\n\nconst ImageContent = ({destination, imgSrc, label, date}) => {\n  if (imgSrc == null) {\n    return (<div></div>)\n  }\n  else {\n    const formatted = date;\n    return (\n      <div>\n        <img src={imgSrc} href={destination} alt={label} />\n        <div id=\"date\">{formatted}</div>\n      </div>\n    )\n  }\n};\n\nconst Sound = ({s3rsc, place, src}) => {\n  if (src == null) {\n    return <div></div>\n  }\n  else {\n    const url = s3rsc(`${place}/aud/${src}`);\n    return (\n      <audio controls><source src={url} type=\"audio/mpeg\"/>Your browser does not support audio!</audio>\n    )\n  }\n};\n\nconst ExternalLink = ({destination, text}) => {\n  if (destination == null || text == null) {\n    return <div></div>\n  }\n  else return (\n    <a className=\"link\" href={destination} target=\"_blank\" rel=\"noreferrer\">{text}</a>\n  )\n};\n\nconst ExternalVideo = ({src}) => {\n  if (src == null) {\n    return <div></div>\n  }\n  else {\n    const url = `https://www.youtube.com/embed/${src}`;\n    return (\n      <iframe width=\"400\" height=\"225\" src={url} title=\"YouTube video player\" frameBorder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" referrerPolicy=\"strict-origin-when-cross-origin\" allowFullScreen></iframe>\n    )\n  }\n};\n\nexport {paintMarker};","import React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport './MapStyleControl.scss';\n\nconst MapStyleControl = ({options, setStyleCb}) => {\n\n    const [state, setState] = useState(\"closed\");\n    const [style, setStyle] = useState(options[0].url);\n\n    useEffect(() => setStyleCb(style), [style]);\n\n    function toggle() {\n        if (state === \"open\") {setState(\"closed\");} \n        else {setState(\"open\");}\n    }\n\n    const label = `${state === \"open\" ? \"Close\" : \"Open\"} layer style menu.`;\n\n    function styleLabel(name) {\n        return `Set map style to ${name}`;\n    }\n\n    return (\n        <div id=\"styles\" className={state}>\n            <div className=\"mapboxgl-ctrl mapboxgl-ctrl-group\">\n                <button className=\"mapboxgl-ctrl-icon\" onClick={toggle} title={label} aria-label={label}><span className=\"material-icons\">layers</span></button>\n            </div>\n            <ol>{options.map(({name, url}) => \n                <div key={name}>\n                    <li className={style === url ? \"selected\" : \"\"} onClick={() => setStyle(url)} title={styleLabel(name)} aria-label={styleLabel(name)} >{name}</li>\n                </div>\n            )}</ol>\n        </div>\n    )\n};\n\nclass MapBoxControl {\n    constructor(options) {\n        this.container = document.createElement('div');\n        this.container.className = 'mapboxgl-ctrl';\n        this.component = (<MapStyleControl options={options} setStyleCb={(url) => this.map.setStyle(url)} />);\n    }\n  \n    onAdd(map) {\n        this.map = map;\n        this.render();\n        return this.container;\n    }\n  \n    onRemove() {\n        this.container.parentNode.removeChild(this.container);\n        this.map = undefined;\n    }\n  \n    render() {\n        ReactDOM.render(this.component, this.container);\n    }\n  }\n\nexport default MapBoxControl;\n","let _ = require('underscore');\nlet _cache = {};\nlet _filter_local_places = (p) => window.location.host === \"localhost:3000\" || !p.local;\n\nconst s3 = ({s3}) => {\n\n  const s3rsc = where => `${s3.bucketUrl}/gps/s3/${where}?rev=${(new Date()).getTime()}`;\n\n  const fetchPlaces = () =>\n    _fetchJSON(\"all_rivers\")\n      .then(({places}) => {\n        const dat = _.chain(places)\n          .filter(_filter_local_places)\n          .sortBy(\"disp\")\n          .map((p,i) => _.extend(p, {i}))\n          .reduce(((acc, {disp, id, i}) => _.extend(acc, {[id]:{disp, i, loaded:false}})), {})\n          .value();\n        return Promise.resolve(dat);\n      });\n\n  const loadPlace = (place, paintData) => {\n    if (place != null && _cache[place] == null) {\n      return _fetchJSON(`${place}/info`)\n        .then(json => {\n            _cache[place] = json;\n            _.each(json.layers, layer => \n              fetch(s3rsc(`${place}/geojson/${layer}`))\n                .then((res) => res.json())\n                .then(paintData(layer)));\n            return Promise.resolve({json:json, paint:true});\n        })\n    }\n    else {\n      return Promise.resolve({json:_cache[place], paint:place == null});\n    }\n  };\n\n  const _fetchJSON = which =>\n    fetch(s3rsc(`${which}.json`))\n      .then(res => {\n        if (res.ok) {\n          return(res.json());\n        }\n        else {\n          return Promise.reject(`Unable to fetch ${which}.json`);\n        }\n      });\n  \n  return {s3rsc, fetchPlaces, loadPlace};\n};\n\nexport {s3};","import React, { useRef, useEffect, useState } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport './Map.scss';\nimport Menu from './Menu';\nimport Legend from './Legend';\nimport {paintMarker} from './Marker'\nimport MapStyleControl from './MapStyleControl'\nimport {s3} from './S3';\nlet _ = require('underscore');\n\nconst hashToPlace = () => window.location.hash.split(\"#\")[1];\n\nconst Map = ({config}) => {\n  mapboxgl.accessToken = config.map.accessToken;\n  const {s3rsc, loadPlace, fetchPlaces} = s3(config);\n\n  const fetchPlacesRef = useRef(fetchPlaces);\n  const map = useRef(null);\n  const mapStylesRef = useRef(config.map.mapStyles);\n  const hoveredFtRef = useRef(null), selectedFtRef = useRef(null);\n  const mapContainerRef = useRef(null);\n  const attributionRef = useRef(config.map.attribution);\n  const centerRef = useRef(config.map.center);\n  const zoomRef = useRef(config.map.zoom);\n  const showLocationsRef = useRef(config.map.showLocations);\n  const geolocationRef = useRef(config.map.geolocation);\n  const circleRadiusRef = useRef(config.map.circleRadius);\n  const circleStrokeWidthRef = useRef(config.map.circleStrokeWidth);\n  const circleStrokeColorRef = useRef(config.map.circleStrokeColor);\n  const colorWaterMarkerRef = useRef(config.map.colorWaterMarker);\n  const colorNonWaterMarkerRef = useRef(config.map.colorNonWaterMarker);\n  const colorPolyFillRef = useRef(config.map.colorPolyFill);\n  const colorRiverRef = useRef(config.map.colorRiver);\n  const colorTrackRef = useRef(config.map.colorTrack);\n  const paintPolyRef = useRef(config.map.paintPoly);\n  const paintTrackRef = useRef(config.map.paintTrack);\n  const paintRiversSmRef = useRef(config.map.paintRiversSm);\n  const paintRiversLgRef = useRef(config.map.paintRiversLg);\n  const legendRef = useRef(config.map.legend);\n\n  const mapData = useRef({});\n  \n  const [places, setPlaces] = useState(null);\n  const [legendVisible, setLegendVisible] = useState(false);\n  const [error, setError] = useState(null);\n  const [modalHtml, setModalHtml] = useState(null);\n  const [desc, setDesc] = useState(null);\n  \n  const paintPlaceRef = useRef((place, initialPlaces) => {\n    const paintData = place => lID0 => data => {\n      if (place == null) return;\n      mapData.current[lID0] = () => {\n        const lID1 = `layer-${place}-${lID0}`;\n        map.current.addSource(lID1, {\n          type: 'geojson',\n          data: data\n        });\n      \n        const kinds = lID0.replace(\".geojson\", \"\").split(\"-\");\n        addPoints(lID1, kinds);\n        addPolys(lID1);\n        addLines(lID1, kinds);\n      }\n      mapData.current[lID0]();\n\n      // Reload this data if map style changes\n      map.current.on('style.load', mapData.current[lID0]);\n    };\n    \n    const addPoints = (lID0, kinds) => {\n      const isWaterMarker = kinds.indexOf(\"cenote\") !== -1 || kinds.indexOf(\"river\") !== -1;\n      const lID1 = `${lID0}-points`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'circle',\n        'source': lID0,\n        'paint': {\n          'circle-radius': circleRadiusRef.current,\n          'circle-stroke-width': circleStrokeWidthRef.current,\n          'circle-stroke-color': circleStrokeColorRef.current,\n          'circle-color': (isWaterMarker ? colorWaterMarkerRef.current : colorNonWaterMarkerRef.current)\n        },\n        'filter': ['==', '$type', 'Point']\n      });\n      addListeners(lID1);\n    };\n    \n    const addListeners = lID => {\n      map.current.on('mousemove', lID, drawTooltip);\n      map.current.on('click', lID, drawDescription);\n      map.current.on('mouseleave', lID, () => map.current.fire('closeAllPopups'));\n    };\n    \n    const drawDescription = ({lngLat, features}) => {\n      setModalHtml(null);\n      if (features.length === 0 || features[0].layer.type === \"line\" ) return;\n      let content = features[0].properties.description;\n      if (content !== undefined && content.length > 0) {\n        if (features.length === 0 ) return;\n        const ft = features[0];\n        const loc = ft.geometry.type === \"Point\" ? ft.geometry.coordinates : lngLat.wrap();\n        if (content.indexOf('http') === 0) content = `<a href='${content}' target='_blank'>${content}</a>`;\n        setModalHtml({loc, html:content});\n      }\n      else {\n        drawTooltip({lngLat, features});\n      }\n    };\n    \n    const drawTooltip = ({lngLat, features}) => {\n      if (features.length === 0 ) return;\n    \n      if (hoveredFtRef.current != null) {\n        hoveredFtRef.current.remove();\n      }\n      const ft = features[0], name = ft.properties[\"name\"] || ft.properties[\"Name\"];\n      if (name == null || name.length === 0) return;\n      const coord = ft.geometry.type === \"Point\" ? ft.geometry.coordinates : lngLat.wrap();\n      \n      const el = document.createElement('div');\n      el.textContent = name;\n    \n      hoveredFtRef.current = new mapboxgl.Popup({offset: [0, -15]})\n        .setLngLat(coord)\n        .setDOMContent(el)\n        .addTo(map.current);\n    \n      el.parentNode.parentNode.className += ' tip hovered';\n    \n      map.current.on('closeAllPopups', () => { \n        if (hoveredFtRef.current != null) {\n          hoveredFtRef.current.remove();\n        }\n      });\n    };\n    \n    const addPolys = lID0 => {\n      map.current.addLayer({\n        'id':  `${lID0}-outline`,\n        'type': 'line',\n        'source': lID0,\n        'paint': paintPolyRef.current,\n        'filter': ['==', '$type', 'Polygon']\n      });\n      const lID1 = `${lID0}-area`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'fill',\n        'source': lID0,\n        'paint': {\n          'fill-color': colorPolyFillRef.current,\n          'fill-opacity': 0.1\n        },\n        'filter': ['==', '$type', 'Polygon']\n      });\n      addListeners(lID1);\n    };\n    \n    const addLines = (lID0, kinds) => {\n      const isTrack = kinds.indexOf(\"track\") !== -1;\n      const isSmRiver = kinds.indexOf(\"sm\") !== -1;\n      const lID1 = `${lID0}-lines`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'line',\n        'source': lID0,\n        'layout': {\n          'line-join': 'round',\n          'line-cap': 'round'\n        },\n        'paint': (isTrack ? paintTrackRef.current : isSmRiver ? paintRiversSmRef.current : paintRiversLgRef.current),\n        'filter': ['==', '$type', 'LineString']\n      });\n      addListeners(lID1);\n    };\n\n    return loadPlace(place, paintData(place))\n      .then(({json, paint}) => {\n        if (paint) {\n          // first time setting places, hash indicates no place in particular\n          if (place == null && initialPlaces != null)\n            setPlaces(initialPlaces);\n          else {\n            // hash indicates a specific place, may be first load or not\n            setPlaces(prev0 => {\n              const prev1 = prev0 || initialPlaces;\n              return ({...prev1, [place]:({...prev1[place], loaded:true})})\n            });\n            if (json != null) _.each(json.locations, paintMarker(s3rsc, map.current, place, setModalHtml, showLocationsRef.current));\n          }\n        }\n        if (json == null)\n          setDesc(null);\n        else {\n          const pos = _.findWhere(json.locations, {\"label\":json.center}).loc;\n          map.current.flyTo({center:[pos.lng, pos.lat], zoom: json.zoom});\n          setDesc(json.desc);\n        }\n        setError(null);\n        setLegendVisible(true);\n      })\n      .catch((err) => {\n        console.log(err);\n        setError(\"That place does not exist.\");\n      });\n    });\n  \n  useEffect(() => {\n    if (modalHtml != null) {\n      const r = 15, s = 2;\n      selectedFtRef.current = new mapboxgl.Popup({offset: [0, r*1.25+s/2]})\n        .setLngLat(modalHtml.loc)\n        .setHTML(`<svg class='tip selected' width='${r*2}' height='${r*2}'><circle fill='${colorTrackRef.current}' fill-opacity='0.25' stroke-width='${s}' stroke='${colorTrackRef.current}' r='${r}' cx='${r}' cy='${r}'></circle></svg>`)\n        .addTo(map.current);\n    }\n    else if (selectedFtRef.current != null) {\n      selectedFtRef.current.remove();\n    }\n  }, [modalHtml]);\n\n  // Initialize map when component mounts\n  useEffect(() => {\n    if (map.current) return;\n\n    map.current = new mapboxgl.Map({\n        container: mapContainerRef.current,\n        center: centerRef.current,\n        zoom: zoomRef.current,\n        attributionControl: false,\n        projection: 'globe',\n        style: mapStylesRef.current[0].url\n      })\n      .addControl(new mapboxgl.AttributionControl({compact: true, customAttribution: attributionRef.current}))\n      .addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}))\n      .addControl(new mapboxgl.NavigationControl(), 'top-right')\n      .once('load', () => {\n        fetchPlacesRef.current().then((res) => {\n          if (res == null) setError(\"Could not fetch places.\")\n          else {\n            const doLoad = initialPlaces => {\n              let curr = hashToPlace();\n              paintPlaceRef.current(curr, initialPlaces);\n            }\n            doLoad(res);\n            window.onhashchange = () => doLoad();\n          }\n        });\n      });\n\n      if (geolocationRef.current)\n        map.current.addControl(\n          new mapboxgl.GeolocateControl({\n            positionOptions: {\n            enableHighAccuracy: true\n          },\n          trackUserLocation: true,\n          showUserHeading: true\n          })\n        );\n      \n      if (mapStylesRef.current.length > 1) map.current.addControl(new MapStyleControl(mapStylesRef.current), 'top-right');\n\n    // Clean up on unmount\n    return () => map.current.remove();\n  }, []);\n\n  return (\n    <div>\n      <div id=\"my-controls\">\n        <Menu places={places} />\n        <Legend available={legendRef.current} visible={legendVisible} colorRiver={colorRiverRef.current} colorTrack={colorTrackRef.current} />\n      </div>\n      <Error message={error} />\n      <Desc html={desc} />\n      <div className='map-container' ref={mapContainerRef} />\n      <Modal html={modalHtml} close={()=>setModalHtml(null)} />\n    </div>\n  );\n};\n\nconst Error = ({message}) => {\n  if (message != null) {\n    return (\n      <div id=\"center-message\">\n        <div id=\"message-container\">\n          <div id=\"message\">{message}</div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Desc = ({html}) => {\n  if (html != null) {\n    return (\n      <div id=\"desc-container\">\n        <div id=\"desc\" dangerouslySetInnerHTML={{ __html: html }}></div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Modal = ({html, close}) => {\n  if (html != null) {\n    return (\n      <div id=\"modal-container\">\n        <div id=\"scroller\">\n          <div id=\"modal\">\n            <span className=\"material-icons close\" onClick={close}>close</span>\n            <div id=\"content\" dangerouslySetInnerHTML={{ __html: html.html }}></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nexport default Map;\n","const config = {\n    site: {\n        title: \"Mel Mitchell-Jackson Adventures\"\n    },\n    s3: {\n        bucketUrl : \"https://d19ukusntnkj32.cloudfront.net\"\n    },\n    map : {\n        accessToken : \"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A\",\n        mapStyles : [\n            {\n                \"name\":\"Persistent Bloom\",\n                \"url\":\"mapbox://styles/edoardschooner/clwr7skwh00xr01pp5luy4z3l\"\n            }\n        ],\n        showLocations: false,\n        center: [-119.509444, 37.229722],\n        zoom: 5,\n        attribution : `Â© Wes Jackson ${new Date().getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`,\n        geolocation: false,\n        circleRadius: 12,\n        circleStrokeWidth: 2,\n        circleStrokeColor: '#ffffff',\n        colorWaterMarker: '#4A4672',\n        colorNonWaterMarker: '#B04D5B',\n        colorPolyFill: '#CF664F',\n        colorRiver: '#4A4672',\n        colorTrack: '#B04D5B',\n        paintPoly: { 'line-color': '#CF664F', 'line-width': 1, 'line-opacity':0.85 },\n        paintTrack: { 'line-color': '#B04D5B', 'line-width': 2, 'line-opacity':0.6},\n        paintRiversSm: { 'line-color': '#4A4672', 'line-width': 1, 'line-opacity': 0.6},\n        paintRiversLg: { 'line-color': '#4A4672', 'line-width': 2, 'line-opacity': 1.0},\n        legend: {'aud':false, 'img':true, 'water':true, 'human':false, 'other':false, 'river':true, 'route':true}\n    }\n}\n\nexport {config};","import React from 'react';\nimport Map from './Map';\nimport {config} from './custom/Config';\n\nfunction App() {\n  return (\n    <div>\n      <title>{config.site.title}</title>\n      <Map config={config}/>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}