(this.webpackJsonpmultimap=this.webpackJsonpmultimap||[]).push([[0],{12:function(e,t,c){},13:function(e,t,c){},14:function(e,t,c){},16:function(e,t,c){},20:function(e,t,c){"use strict";c.r(t);var n=c(2),s=c.n(n),l=c(6),o=c.n(l),a=(c(12),c(3)),i=c.n(a),r=(c(13),c(14),c(0));const d=({menuState:e,toggle:t})=>Object(r.jsxs)("div",{id:"hamburger",className:e,onClick:t,children:[Object(r.jsx)("span",{}),Object(r.jsx)("span",{}),Object(r.jsx)("span",{}),Object(r.jsx)("span",{})]}),j=({menuState:e,paintPlace:t,places:c,toggle:n})=>{const s={height:("open"===e?26*c.length-18+18:0)+"px",padding:"0px 6px 0px 6px"},l={paddingTop:"18px"};return Object(r.jsx)("div",{id:"places",className:e,style:s,children:Object(r.jsx)("ol",{style:l,children:c.map((({disp:e,id:c})=>Object(r.jsx)("div",{children:Object(r.jsx)(u,{paintPlace:t,closeMenu:n,disp:e,id:c})},c)))})})},u=({paintPlace:e,closeMenu:t,disp:c,id:s})=>{const[l,o]=Object(n.useState)("unloaded");return Object(r.jsx)("li",{id:s,className:l,style:{fontSize:"14px"},onClick:function(){e(s).then((()=>{o("loaded"),t()}))},children:c})};var p=({paintPlace:e,places:t})=>{const[c,s]=Object(n.useState)("loading");function l(){s("open"===c?"closed":"open")}return"loading"===c&&t.length>0&&s("open"),Object(r.jsxs)("div",{id:"menu",className:c,children:[Object(r.jsx)(d,{menuState:c,toggle:l}),Object(r.jsx)(j,{menuState:c,paintPlace:e,places:t,toggle:l})]})};c(16);const m=({color:e})=>Object(r.jsx)("svg",{width:"35px",children:Object(r.jsx)("circle",{r:"5",cx:"13",cy:"13",fill:e})}),b=({color:e})=>Object(r.jsx)("svg",{width:"35px",children:Object(r.jsx)("line",{x1:"0",x2:"25",y1:"13",y2:"13",stroke:e})});var h=({visible:e,colorRiver:t,colorTrack:c})=>e?Object(r.jsxs)("div",{id:"legend",children:[Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)("div",{id:"eg-aud",className:"eg-marker"}),Object(r.jsx)("span",{children:"sound"})]}),Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)("div",{id:"eg-img",className:"eg-marker"}),Object(r.jsx)("span",{children:"photo"})]}),Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)(m,{color:t}),Object(r.jsx)("span",{children:"water feature"})]}),Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)(m,{color:c}),Object(r.jsx)("span",{children:"human feature"})]}),Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)(m,{color:"#000000"}),Object(r.jsx)("span",{children:"other feature"})]}),Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)(b,{color:t}),Object(r.jsx)("span",{children:"river"})]}),Object(r.jsxs)("div",{className:"item",children:[Object(r.jsx)(b,{color:c}),Object(r.jsx)("span",{children:"my route"})]})]}):Object(r.jsx)("div",{}),x=c(7),O=c.n(x);c(18);const g=e=>{let t=document.createElement("div");return null!=e.aud?t.className="marker-aud":null!=e.img&&(t.className="marker-img"),t},v=({s3rsc:e,place:t,location:c})=>{const n=c.label||"",s=c.img?e(`${t}/imgLg/${c.img}`):null,l=c.img?e(`${t}/imgSm/${c.img}`):null,o=c.date?c.date.split(" ")[0].replaceAll(":","."):null;return Object(r.jsxs)("div",{children:[Object(r.jsx)(f,{location:c}),Object(r.jsx)("h3",{children:n}),Object(r.jsx)(y,{srcLg:s,srcSm:l,label:n,date:o}),Object(r.jsx)(k,{s3rsc:e,place:t,src:c.aud})]})},f=({location:e})=>{const t=e.loc.lat.toFixed(4),c=e.loc.lng.toFixed(4),n=`https://www.google.com/maps/search/?api=1&query=${e.loc.lat},${e.loc.lng}`;return Object(r.jsxs)("div",{className:"icon link",children:[Object(r.jsx)("span",{className:"material-icons",children:"map"}),Object(r.jsxs)("a",{href:n,target:"_",children:[t,",",c]})]})},y=({srcLg:e,srcSm:t,label:c,date:n})=>Object(r.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:Object(r.jsx)(w,{srcLg:e,srcSm:t,label:c,date:n})}),w=({srcLg:e,srcSm:t,label:c,date:n})=>{if(null==t||null==e)return Object(r.jsx)("div",{});{const s=n;return Object(r.jsxs)("div",{children:[Object(r.jsx)("img",{src:t,href:e,alt:c}),Object(r.jsx)("div",{id:"date",children:s})]})}},k=({s3rsc:e,place:t,src:c})=>{if(null==c)return Object(r.jsx)("div",{});{const n=e(`${t}/aud/${c}`);return Object(r.jsxs)("audio",{controls:!0,children:[Object(r.jsx)("source",{src:n,type:"audio/mpeg"}),"Your browser does not support audio!"]})}};let S=c(5),$={},N=e=>"localhost:3000"===window.location.host||!e.local;const P=({paintPlace:e,setError:t},c)=>{let n=null;(n=c.split("#")[1])&&e(n).then((()=>{let e=null;(e=document.getElementById(n))&&(e.className="loaded",t(null))}))};var L={connect:e=>{P(e,window.location.hash),window.onhashchange=()=>{P(e,window.location.hash)}},setHash:e=>window.location.hash=e};let C=c(5);const T="#ff0000",z="#00bcff",M="#ff2592";let _=null;const A=(e,t,c,n)=>{const s=-1!==c.indexOf("cenote")||-1!==c.indexOf("river"),l=`${t}-points`;e.addLayer({id:l,type:"circle",source:t,paint:{"circle-radius":6,"circle-color":s?"#2592ff":"#ff2592"},filter:["==","$type","Point"]}),E(e,l,n)},E=(e,t,c)=>{e.on("mousemove",t,H(e,t)),e.on("click",t,J(e,t,c)),e.on("mouseleave",t,(()=>e.fire("closeAllPopups")))},J=(e,t,c)=>({lngLat:n,features:s})=>{if(void 0!==c&&c(null),0===s.length)return;const l=s[0].properties.description;void 0!==l&&l.length>0?void 0!==c&&c(l):H(e,t)({lngLat:n,features:s})},H=(e,t)=>({lngLat:t,features:c})=>{if(0===c.length)return;null!=_&&(_.remove(),_=null);const n=c[0],s="Point"===n.geometry.type?n.geometry.coordinates:t.wrap(),l=document.createElement("div");l.textContent=n.properties.name,_=new i.a.Popup({offset:[0,-15]}).setLngLat(s).setDOMContent(l).addTo(e),l.parentNode.parentNode.className+=" tip",e.on("closeAllPopups",(()=>{null!=_&&_.remove(),_=null}))},I=(e,t,c)=>{const n=-1!==c.indexOf("track"),s=-1!==c.indexOf("sm"),l=`${t}-lines`;e.addLayer({id:l,type:"line",source:t,layout:{"line-join":"round","line-cap":"round"},paint:n?F:D(s),filter:["==","$type","LineString"]}),E(e,l)},R=(e,t,c)=>{e.addLayer({id:`${t}-outline`,type:"line",source:t,paint:U,filter:["==","$type","Polygon"]});const n=`${t}-area`;e.addLayer({id:n,type:"fill",source:t,paint:{"fill-color":T,"fill-opacity":.1},filter:["==","$type","Polygon"]}),E(e,n,c)},D=e=>({"line-color":z,"line-width":e?1:2,"line-opacity":e?.6:1}),F={"line-color":M,"line-width":2,"line-opacity":.6},U={"line-color":T,"line-width":2,"line-opacity":.25},W=({message:e})=>null!=e?Object(r.jsx)("div",{id:"center-message",children:Object(r.jsx)("div",{id:"message-container",children:Object(r.jsx)("div",{id:"message",children:e})})}):Object(r.jsx)("div",{}),B=({html:e})=>null!=e?Object(r.jsx)("div",{id:"desc-container",children:Object(r.jsx)("div",{id:"desc",dangerouslySetInnerHTML:{__html:e}})}):Object(r.jsx)("div",{}),Y=({html:e,close:t})=>null!=e?Object(r.jsx)("div",{id:"modal-container",children:Object(r.jsx)("div",{id:"scroller",children:Object(r.jsxs)("div",{id:"modal",children:[Object(r.jsx)("span",{className:"material-icons close",onClick:t,children:"close"}),Object(r.jsx)("div",{id:"content",dangerouslySetInnerHTML:{__html:e}})]})})}):Object(r.jsx)("div",{});var Z=({config:e})=>{const{s3rsc:t,loadPlace:c,fetchPlaces:s}=(({s3:e})=>{const t=t=>`${e.bucketUrl}/gps/s3/${t}?rev=${(new Date).getTime()}`,c=e=>fetch(t(`${e}.json`)).then((t=>t.ok?t.json():Promise.reject(`Unable to fetch ${e}.json`))),n=(e,c)=>n=>fetch(t(`${e}/geojson/${n}`)).then((e=>e.json())).then(c(n));return{s3rsc:t,fetchPlaces:()=>c("all_rivers").then((({places:e})=>{const t=S.chain(e).filter(N).sortBy("disp").value();return Promise.resolve(t)})),loadPlace:(e,t)=>null==$[e]?c(`${e}/info`).then((c=>($[e]=c,S.each(c.layers,n(e,t)),Promise.resolve({json:c,paint:!0})))):Promise.resolve({json:$[e],paint:!1})}})(e);i.a.accessToken=e.map.accessToken;const l=Object(n.useRef)(null),[o,a]=Object(n.useState)(null),[d,j]=Object(n.useState)([]),[u,m]=Object(n.useState)(!1),[b,x]=Object(n.useState)(null),[f,y]=Object(n.useState)(null),[w,k]=Object(n.useState)(null),P=(e,n,s)=>l=>c(l,((e,t,c)=>n=>s=>{const l=`layer-${t}-${n}`;e.addSource(l,{type:"geojson",data:s});const o=n.replace(".geojson","").split("-");A(e,l,o,c),R(e,l,c),I(e,l,o)})(e,l,y)).then((({json:c,paint:s})=>{((e,{zoom:t,locations:c,center:n})=>{const s=C.findWhere(c,{label:n}).loc;e.flyTo({center:[s.lng,s.lat],zoom:t})})(e,c),s&&(C.each(c.locations,((e,t,c,n)=>s=>{const l=document.createElement("div"),o=new i.a.Popup({className:"media",closeOnClick:!0,offset:25}).setDOMContent(l);new i.a.Marker(g(s)).setLngLat([s.loc.lng,s.loc.lat]).setPopup(o).addTo(t);const a=O.a.renderToString(Object(r.jsx)(v,{s3rsc:e,place:c,location:s}));o.on("open",(()=>n(a)))})(t,e,l,y)),k(c.desc),n(l))})).catch((()=>s("That place does not exist."))),T=e=>P(e,(e=>{x(null),m(!0),L.setHash(e)}),x);return Object(n.useEffect)((()=>{const t=new i.a.Map({container:l.current,style:e.map.mapStyle,attributionControl:!1,center:e.map.center,zoom:e.map.zoom}).addControl(new i.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})).addControl(new i.a.AttributionControl({compact:!0,customAttribution:e.map.attribution})).addControl(new i.a.FullscreenControl({container:document.querySelector("body")})).addControl(new i.a.NavigationControl,"top-right").once("load",(()=>s().then((e=>{null==e?x("Could not fetch places."):(j(e),a(t),L.connect({paintPlace:T(t),setError:x}))}))));return()=>t.remove()}),[]),Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{id:"my-controls",children:[Object(r.jsx)(p,{paintPlace:T(o),places:d}),Object(r.jsx)(h,{visible:u,colorRiver:z,colorTrack:M})]}),Object(r.jsx)(W,{message:b}),Object(r.jsx)(B,{html:w}),Object(r.jsx)("div",{className:"map-container",ref:l}),Object(r.jsx)(Y,{html:f,close:()=>y(null)})]})};const q={site:{title:"Rivers of CA"},s3:{bucketUrl:"https://s3-us-west-2.amazonaws.com/multimap-2"},map:{accessToken:"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A",mapStyle:"mapbox://styles/edoardschooner/cku8yh0id5za818rmtnwt7zzo",center:[-119.509444,37.229722],zoom:5,attribution:`\xa9 Wes Jackson ${(new Date).getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`}};var G=function(){return Object(r.jsxs)("div",{children:[Object(r.jsx)("title",{children:q.site.title}),Object(r.jsx)(Z,{config:q})]})};o.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(G,{})}),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.450fcb55.chunk.js.map