(this.webpackJsonpmultimap=this.webpackJsonpmultimap||[]).push([[0],[,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){},,,function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c=n(2),l=n.n(c),s=n(5),r=n.n(s),o=(n(12),n(3)),a=n.n(o),i=(n(13),n(14),n(0));let d=n(6);const u=e=>{let{menuState:t,toggle:n}=e;const c=("open"===t?"Close":"Open")+" map navigation menu.";return Object(i.jsxs)("button",{id:"hamburger",className:t,onClick:n,title:c,"aria-label":c,children:[Object(i.jsx)("span",{}),Object(i.jsx)("span",{}),Object(i.jsx)("span",{}),Object(i.jsx)("span",{})]})},j=e=>{let{menuState:t,places:n}=e;const c=d.chain(n).keys().map((e=>{const t=n[e];return{id:e,disp:t.disp,className:t.loaded?"loaded":"unloaded"}})).sortBy("disp").value(),l={height:("open"===t?26*c.length-18+18:0)+"px",padding:"0px 6px 0px 6px"},s={paddingTop:"18px"};return Object(i.jsx)("div",{id:"places",className:t,style:l,children:Object(i.jsx)("ol",{style:s,children:c.map((e=>Object(i.jsx)("div",{children:Object(i.jsx)(m,{id:e.id,className:e.className,disp:e.disp})},e.id)))})})},m=e=>{let{id:t,className:n,disp:c}=e;const l=`Show map of ${c}.`;return Object(i.jsx)("li",{id:t,className:n,style:{fontSize:"14px"},children:Object(i.jsx)("a",{href:"#"+t,title:l,"aria-label":l,children:c})})};var p=e=>{let{places:t}=e;const[n,l]=Object(c.useState)("loading");return"loading"===n&&d.size(t)>0&&l("open"),Object(i.jsxs)("div",{id:"menu",className:n,children:[Object(i.jsx)(u,{menuState:n,toggle:function(){l("open"===n?"closed":"open")}}),Object(i.jsx)(j,{menuState:n,places:t})]})};n(17);const b=e=>{let{color:t}=e;return Object(i.jsx)("svg",{width:"35px",children:Object(i.jsx)("circle",{r:"5",cx:"13",cy:"13",fill:t})})},h=e=>{let{color:t}=e;return Object(i.jsx)("svg",{width:"35px",children:Object(i.jsx)("line",{x1:"0",x2:"25",y1:"13",y2:"13",stroke:t})})};var x=e=>{let{visible:t,colorRiver:n,colorTrack:c}=e;return t?Object(i.jsxs)("div",{id:"legend",children:[Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)("div",{id:"eg-aud",className:"eg-marker"}),Object(i.jsx)("span",{children:"sound"})]}),Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)("div",{id:"eg-img",className:"eg-marker"}),Object(i.jsx)("span",{children:"photo"})]}),Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)(b,{color:n}),Object(i.jsx)("span",{children:"water feature"})]}),Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)(b,{color:c}),Object(i.jsx)("span",{children:"human feature"})]}),Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)(b,{color:"#000000"}),Object(i.jsx)("span",{children:"other feature"})]}),Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)(h,{color:n}),Object(i.jsx)("span",{children:"river"})]}),Object(i.jsxs)("div",{className:"item",children:[Object(i.jsx)(h,{color:c}),Object(i.jsx)("span",{children:"my route"})]})]}):Object(i.jsx)("div",{})},O=n(7),f=n.n(O);n(19);const g=e=>{let t=document.createElement("div");return null!=e.aud?t.className="marker-aud":null!=e.img&&(t.className="marker-img"),t},v=e=>{let{s3rsc:t,place:n,location:c}=e;const l=c.label||"",s=c.img?t(`${n}/imgLg/${c.img}`):null,r=c.img?t(`${n}/imgSm/${c.img}`):null,o=c.date?c.date.split(" ")[0].replaceAll(":","."):null;return Object(i.jsxs)("div",{children:[Object(i.jsx)(y,{location:c}),Object(i.jsx)("h3",{children:l}),Object(i.jsx)(w,{srcLg:s,srcSm:r,label:l,date:o}),Object(i.jsx)(k,{s3rsc:t,place:n,src:c.aud})]})},y=e=>{let{location:t}=e;const n=t.loc.lat.toFixed(4),c=t.loc.lng.toFixed(4),l=`https://www.google.com/maps/search/?api=1&query=${t.loc.lat},${t.loc.lng}`;return Object(i.jsxs)("div",{className:"icon",children:[Object(i.jsx)("span",{className:"material-icons",children:"map"}),Object(i.jsxs)("a",{href:l,target:"_",children:[n,",",c]})]})},w=e=>{let{srcLg:t,srcSm:n,label:c,date:l}=e;return Object(i.jsx)("a",{href:t,target:"_blank",rel:"noreferrer",children:Object(i.jsx)($,{srcLg:t,srcSm:n,label:c,date:l})})},$=e=>{let{srcLg:t,srcSm:n,label:c,date:l}=e;if(null==n||null==t)return Object(i.jsx)("div",{});{const e=l;return Object(i.jsxs)("div",{children:[Object(i.jsx)("img",{src:n,href:t,alt:c}),Object(i.jsx)("div",{id:"date",children:e})]})}},k=e=>{let{s3rsc:t,place:n,src:c}=e;if(null==c)return Object(i.jsx)("div",{});{const e=t(`${n}/aud/${c}`);return Object(i.jsxs)("audio",{controls:!0,children:[Object(i.jsx)("source",{src:e,type:"audio/mpeg"}),"Your browser does not support audio!"]})}};n(20);const N=e=>{let{options:t,setStyleCb:n}=e;const[l,s]=Object(c.useState)("closed"),[r,o]=Object(c.useState)(t[0].url);Object(c.useEffect)((()=>n(r)),[r]);const a=("open"===l?"Close":"Open")+" layer style menu.";function d(e){return`Set map style to ${e}`}return Object(i.jsxs)("div",{id:"styles",className:l,children:[Object(i.jsx)("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",children:Object(i.jsx)("button",{className:"mapboxgl-ctrl-icon",onClick:function(){s("open"===l?"closed":"open")},title:a,"aria-label":a,children:Object(i.jsx)("span",{className:"material-icons",children:"layers"})})}),Object(i.jsx)("ol",{children:t.map((e=>{let{name:t,url:n}=e;return Object(i.jsx)("div",{children:Object(i.jsx)("li",{className:r===n?"selected":"",onClick:()=>o(n),title:d(t),"aria-label":d(t),children:t})},t)}))})]})};var S=class{constructor(e){this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",this.component=Object(i.jsx)(N,{options:e,setStyleCb:e=>this.map.setStyle(e)})}onAdd(e){return this.map=e,this.render(),this.container}onRemove(){this.container.parentNode.removeChild(this.container),this.map=void 0}render(){r.a.render(this.component,this.container)}};let C=n(6),L={},P=e=>"localhost:3000"===window.location.host||!e.local;let T=n(6);const R="#ff2592",z="#00bcff",M=R,_={"line-color":"#ff6c6c","line-width":1,"line-opacity":.85},A={"line-color":M,"line-width":2,"line-opacity":.6},J=e=>{let{message:t}=e;return null!=t?Object(i.jsx)("div",{id:"center-message",children:Object(i.jsx)("div",{id:"message-container",children:Object(i.jsx)("div",{id:"message",children:t})})}):Object(i.jsx)("div",{})},E=e=>{let{html:t}=e;return null!=t?Object(i.jsx)("div",{id:"desc-container",children:Object(i.jsx)("div",{id:"desc",dangerouslySetInnerHTML:{__html:t}})}):Object(i.jsx)("div",{})},H=e=>{let{html:t,close:n}=e;return null!=t?Object(i.jsx)("div",{id:"modal-container",children:Object(i.jsx)("div",{id:"scroller",children:Object(i.jsxs)("div",{id:"modal",children:[Object(i.jsx)("span",{className:"material-icons close",onClick:n,children:"close"}),Object(i.jsx)("div",{id:"content",dangerouslySetInnerHTML:{__html:t.html}})]})})}):Object(i.jsx)("div",{})};var I=e=>{let{config:t}=e;a.a.accessToken=t.map.accessToken;const{s3rsc:n,loadPlace:l,fetchPlaces:s}=(e=>{let{s3:t}=e;const n=e=>`${t.bucketUrl}/gps/s3/${e}?rev=${(new Date).getTime()}`,c=e=>fetch(n(`${e}.json`)).then((t=>t.ok?t.json():Promise.reject(`Unable to fetch ${e}.json`)));return{s3rsc:n,fetchPlaces:()=>c("all_rivers").then((e=>{let{places:t}=e;const n=C.chain(t).filter(P).sortBy("disp").map(((e,t)=>C.extend(e,{i:t}))).reduce(((e,t)=>{let{disp:n,id:c,i:l}=t;return C.extend(e,{[c]:{disp:n,i:l,loaded:!1}})}),{}).value();return Promise.resolve(n)})),loadPlace:(e,t)=>null!=e&&null==L[e]?c(`${e}/info`).then((c=>(L[e]=c,C.each(c.layers,(c=>fetch(n(`${e}/geojson/${c}`)).then((e=>e.json())).then(t(c)))),Promise.resolve({json:c,paint:!0})))):Promise.resolve({json:L[e],paint:null==e})}})(t),r=Object(c.useRef)(s),o=Object(c.useRef)(null),d=Object(c.useRef)(t.map.mapStyles),u=Object(c.useRef)(null),j=Object(c.useRef)(null),m=Object(c.useRef)(null),b=Object(c.useRef)(t.map.attribution),h=Object(c.useRef)(t.map.center),O=Object(c.useRef)(t.map.zoom),y=Object(c.useRef)({}),[w,$]=Object(c.useState)(null),[k,N]=Object(c.useState)(!1),[I,D]=Object(c.useState)(null),[F,U]=Object(c.useState)(null),[W,q]=Object(c.useState)(null),B=Object(c.useRef)(((e,t)=>{const c=(e,t)=>{const n=-1!==t.indexOf("cenote")||-1!==t.indexOf("river"),c=`${e}-points`;o.current.addLayer({id:c,type:"circle",source:e,paint:{"circle-radius":6,"circle-color":n?"#2592ff":R},filter:["==","$type","Point"]}),s(c)},s=e=>{o.current.on("mousemove",e,d),o.current.on("click",e,r),o.current.on("mouseleave",e,(()=>o.current.fire("closeAllPopups")))},r=e=>{let{lngLat:t,features:n}=e;if(U(null),0===n.length||"line"===n[0].layer.type)return;let c=n[0].properties.description;if(void 0!==c&&c.length>0){if(0===n.length)return;const e=n[0],l="Point"===e.geometry.type?e.geometry.coordinates:t.wrap();0===c.indexOf("http")&&(c=`<a href='${c}' target='_blank'>${c}</a>`),U({loc:l,html:c})}else d({lngLat:t,features:n})},d=e=>{let{lngLat:t,features:n}=e;if(0===n.length)return;null!=u.current&&u.current.remove();const c=n[0],l=c.properties.name||c.properties.Name;if(null==l||0===l.length)return;const s="Point"===c.geometry.type?c.geometry.coordinates:t.wrap(),r=document.createElement("div");r.textContent=l,u.current=new a.a.Popup({offset:[0,-15]}).setLngLat(s).setDOMContent(r).addTo(o.current),r.parentNode.parentNode.className+=" tip hovered",o.current.on("closeAllPopups",(()=>{null!=u.current&&u.current.remove()}))},j=e=>{o.current.addLayer({id:`${e}-outline`,type:"line",source:e,paint:_,filter:["==","$type","Polygon"]});const t=`${e}-area`;o.current.addLayer({id:t,type:"fill",source:e,paint:{"fill-color":"#ff6c6c","fill-opacity":.1},filter:["==","$type","Polygon"]}),s(t)},m=(e,t)=>{const n=-1!==t.indexOf("track"),c=-1!==t.indexOf("sm"),l=`${e}-lines`;var r;o.current.addLayer({id:l,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:n?A:(r=c,{"line-color":z,"line-width":r?1:2,"line-opacity":r?.6:1}),filter:["==","$type","LineString"]}),s(l)};return l(e,(e=>t=>n=>{null!=e&&(y.current[t]=()=>{const l=`layer-${e}-${t}`;o.current.addSource(l,{type:"geojson",data:n});const s=t.replace(".geojson","").split("-");c(l,s),j(l),m(l,s)},y.current[t](),o.current.on("style.load",y.current[t]))})(e)).then((c=>{let{json:l,paint:s}=c;if(s&&(null==e&&null!=t?$(t):($((n=>{const c=n||t;return{...c,[e]:{...c[e],loaded:!0}}})),null!=l&&T.each(l.locations,((e,t,n,c)=>l=>{const s=document.createElement("div"),r=new a.a.Popup({className:"media",closeOnClick:!0,offset:25}).setDOMContent(s),o=[l.loc.lng,l.loc.lat];new a.a.Marker(g(l)).setLngLat(o).setPopup(r).addTo(t);const d=f.a.renderToString(Object(i.jsx)(v,{s3rsc:e,place:n,location:l}));r.on("open",(()=>c({loc:o,html:d})))})(n,o.current,e,U)))),null==l)q(null);else{const e=T.findWhere(l.locations,{label:l.center}).loc;o.current.flyTo({center:[e.lng,e.lat],zoom:l.zoom}),q(l.desc)}D(null),N(!0)})).catch((()=>D("That place does not exist.")))}));return Object(c.useEffect)((()=>{if(null!=F){const e=15,t=2;j.current=new a.a.Popup({offset:[0,1.25*e+t/2]}).setLngLat(F.loc).setHTML(`<svg class='tip selected' width='${2*e}' height='${2*e}'><circle fill='${M}' fill-opacity='0.25' stroke-width='${t}' stroke='${M}' r='${e}' cx='${e}' cy='${e}'></circle></svg>`).addTo(o.current)}else null!=j.current&&j.current.remove()}),[F]),Object(c.useEffect)((()=>{if(!o.current)return o.current=new a.a.Map({container:m.current,center:h.current,zoom:O.current,attributionControl:!1,projection:"globe"}).addControl(new a.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})).addControl(new a.a.AttributionControl({compact:!0,customAttribution:b.current})).addControl(new a.a.FullscreenControl({container:document.querySelector("body")})).addControl(new a.a.NavigationControl,"top-right").addControl(new S(d.current),"top-right").once("load",(()=>{r.current().then((e=>{if(null==e)D("Could not fetch places.");else{const t=e=>{let t=window.location.hash.split("#")[1];B.current(t,e)};t(e),window.onhashchange=()=>t()}}))})),()=>o.current.remove()}),[]),Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{id:"my-controls",children:[Object(i.jsx)(p,{places:w}),Object(i.jsx)(x,{visible:k,colorRiver:z,colorTrack:M})]}),Object(i.jsx)(J,{message:I}),Object(i.jsx)(E,{html:W}),Object(i.jsx)("div",{className:"map-container",ref:m}),Object(i.jsx)(H,{html:F,close:()=>U(null)})]})};const D={site:{title:"Mel Mitchell-Jackson Adventures"},s3:{bucketUrl:"https://melmitchelljacksonart-map.s3.us-east-1.amazonaws.com"},map:{accessToken:"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A",mapStyles:[{name:"Light",url:"mapbox://styles/edoardschooner/cku8yh0id5za818rmtnwt7zzo"},{name:"Terrain",url:"mapbox://styles/edoardschooner/cjjyezpmd7pn02rlhom56eiwl"},{name:"Parks",url:"mapbox://styles/edoardschooner/ciqptutzk0046bgm1urgdvwiu"},{name:"Satellite",url:"mapbox://styles/mapbox/satellite-v9"}],center:[-119.509444,37.229722],zoom:5,attribution:`\xa9 Wes Jackson ${(new Date).getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`}};var F=function(){return Object(i.jsxs)("div",{children:[Object(i.jsx)("title",{children:D.site.title}),Object(i.jsx)(I,{config:D})]})};r.a.render(Object(i.jsx)(l.a.StrictMode,{children:Object(i.jsx)(F,{})}),document.getElementById("root"))}],[[21,1,2]]]);
//# sourceMappingURL=main.5dada9f0.chunk.js.map