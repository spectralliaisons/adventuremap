{"version":3,"sources":["Menu.js","Legend.js","Marker.js","S3.js","Map.js","Config.js","App.js","index.js"],"names":["_","require","Hamburger","menuState","toggle","id","className","onClick","Places","places","placesLs","chain","keys","map","pID","o","disp","loaded","sortBy","value","placesStyl","height","length","padding","olStyl","paddingTop","style","p","Item","fontSize","href","Menu","setMenuState","useState","size","Point","color","width","r","cx","cy","fill","Line","x1","x2","y1","y2","stroke","Legend","visible","colorRiver","colorTrack","styledMarker","location","marker","document","createElement","aud","img","Window","s3rsc","place","label","srcLg","srcSm","date","split","replaceAll","Location","Image","Sound","src","lat","loc","toFixed","lng","url","target","rel","ImageContent","formatted","alt","controls","type","_cache","_filter_local_places","window","host","local","colorPoly","paintPoly","paintTrack","Error","message","Desc","html","dangerouslySetInnerHTML","__html","Modal","close","Map","config","mapboxgl","accessToken","loadPlace","fetchPlaces","s3","where","bucketUrl","Date","getTime","_fetchJSON","which","fetch","then","res","ok","json","Promise","reject","dat","filter","i","extend","reduce","acc","resolve","paintData","each","layers","layer","paint","fetchPlacesRef","useRef","tipRef","mapContainerRef","attributionRef","attribution","styleRef","mapStyle","centerRef","center","zoomRef","zoom","setPlaces","legendVisible","setLegendVisible","error","setError","modalHtml","setModalHtml","desc","setDesc","paintPlaceRef","initialPlaces","addPoints","lID0","kinds","isWaterMarker","indexOf","lID1","current","addLayer","addListeners","lID","on","drawTooltip","drawDescription","fire","lngLat","features","content","properties","description","undefined","remove","ft","coord","geometry","coordinates","wrap","el","textContent","name","Popup","offset","setLngLat","setDOMContent","addTo","parentNode","addPolys","addLines","isTrack","isSmRiver","sm","data","addSource","replace","prev0","prev1","locations","popup","closeOnClick","Marker","setPopup","ReactDomServer","renderToString","paintMarker","pos","findWhere","flyTo","catch","useEffect","container","attributionControl","addControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","showUserHeading","AttributionControl","compact","customAttribution","FullscreenControl","querySelector","NavigationControl","once","doLoad","curr","hash","onhashchange","ref","site","title","getFullYear","App","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.cefd50aa.chunk.js","sourcesContent":["import React, {useState} from 'react';\nimport './Menu.scss';\nlet _ = require('underscore');\n\nconst fontSz = 14;\nconst padding = 6;\nconst listPaddingTop = 18;\n\nconst Menu = ({places}) => {\n\n    const [menuState, setMenuState] = useState(\"loading\");\n\n    if (menuState === \"loading\" && _.size(places) > 0) {setMenuState(\"open\");}\n\n    function toggle() {\n        if (menuState === \"open\") {setMenuState(\"closed\");} \n        else {setMenuState(\"open\");}\n    }\n\n    return (\n        <div id='menu' className={menuState}>\n            <Hamburger menuState={menuState} toggle={toggle}/>\n            <Places menuState={menuState} places={places} />\n        </div>\n    );\n};\n\nconst Hamburger = ({menuState, toggle}) => {\n    return (\n        <div id=\"hamburger\" className={menuState} onClick={toggle}>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n    )\n};\n\nconst Places = ({menuState, places}) => {\n    const placesLs = _.chain(places)\n        .keys()\n        .map(pID => {\n            const o = places[pID];\n            return {id:pID, disp:o.disp, className:o.loaded ? \"loaded\" : \"unloaded\"};\n        })\n        .sortBy(\"disp\")\n        .value();\n    const placesStyl = {\n        height:`${(menuState === \"open\" ? (placesLs.length*(fontSz+padding*2)-padding*3+listPaddingTop) : 0)}px`,\n        padding: `0px ${padding}px 0px ${padding}px`\n    };\n    const olStyl = {paddingTop: `${listPaddingTop}px`};\n    return (\n        <div id=\"places\" className={menuState} style={placesStyl}>\n            <ol style={olStyl}>{placesLs.map(p => \n                <div key={p.id}>\n                    <Item id={p.id} className={p.className} disp={p.disp} />\n                </div>\n            )}</ol>\n        </div>\n    )\n};\n\nconst Item = ({id, className, disp}) => {\n    return (\n        <li id={id} className={className} style={{fontSize:`${fontSz}px`}}><a href={\"#\"+id}>{disp}</a></li>\n    );\n};\n\nexport default Menu;\n","import React from 'react';\nimport './Legend.scss';\n\nconst Legend = ({visible, colorRiver, colorTrack}) => {\n    if (visible) {\n        return (\n            <div id=\"legend\">\n                <div className=\"item\">\n                    <div id=\"eg-aud\" className=\"eg-marker\"/>\n                    <span>sound</span>\n                </div>\n                <div className=\"item\">\n                    <div id=\"eg-img\" className=\"eg-marker\"/>\n                    <span>photo</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={colorRiver}/>\n                    <span>water feature</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={colorTrack}/>\n                    <span>human feature</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={\"#000000\"}/>\n                    <span>other feature</span>\n                </div>\n                <div className=\"item\">\n                    <Line color={colorRiver}/>\n                    <span>river</span>\n                </div>\n                <div className=\"item\">\n                    <Line color={colorTrack}/>\n                    <span>my route</span>\n                </div>\n            </div>\n        )\n    }\n    else {\n        return <div></div>\n    }\n};\n\nconst Point = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <circle r=\"5\" cx=\"13\" cy=\"13\" fill={color}></circle>\n        </svg>\n    )\n};\n\nconst Line = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <line x1=\"0\" x2=\"25\" y1=\"13\" y2=\"13\" stroke={color}></line>\n        </svg>\n    )\n};\n\nexport default Legend;","import ReactDomServer from 'react-dom/server'\nimport mapboxgl from 'mapbox-gl';\nimport 'material-icons/iconfont/material-icons.css';\n\nconst paintMarker = (s3rsc, map, place, setModalHtml) => location => {\n  const el = document.createElement('div');\n\n  const popup = new mapboxgl.Popup({ \n    className: 'media', \n    closeOnClick: true,\n    offset: 25 \n  }).setDOMContent(el);\n\n  new mapboxgl.Marker(styledMarker(location))\n    .setLngLat([location.loc.lng, location.loc.lat])\n    .setPopup(popup)\n    .addTo(map);\n\n  const html = ReactDomServer.renderToString(<Window s3rsc={s3rsc} place={place} location={location}/>);\n  popup.on('open', () => setModalHtml(html));\n};\n\nconst styledMarker = location => {\n  let marker = document.createElement('div');\n  if (location.aud != null) {marker.className = 'marker-aud';}\n  else if (location.img != null) {marker.className = 'marker-img';}\n  return marker;\n};\n\nconst Window = ({s3rsc, place, location}) => {\n  const label = location.label || \"\";\n  const srcLg = location.img ? s3rsc(`${place}/imgLg/${location.img}`) : null;\n  const srcSm = location.img ? s3rsc(`${place}/imgSm/${location.img}`) : null;\n  const date = location.date ? location.date.split(\" \")[0].replaceAll(\":\", \".\") : null;\n  return (\n      <div>\n        <Location location={location}/>\n        <h3>{label}</h3>\n        <Image srcLg={srcLg} srcSm={srcSm} label={label} date={date} />\n        <Sound s3rsc={s3rsc} place={place} src={location.aud} />\n      </div>\n  );\n};\n\nconst Location = ({location}) => {\n  const lat = location.loc.lat.toFixed(4);\n  const lng = location.loc.lng.toFixed(4);\n  const url = `https://www.google.com/maps/search/?api=1&query=${location.loc.lat},${location.loc.lng}`;\n  return <div className=\"icon link\"><span className=\"material-icons\">map</span><a href={url} target=\"_\">{lat},{lng}</a></div>\n};\n\nconst Image = ({srcLg, srcSm, label, date}) => {\n  return (\n    <a href={srcLg} target=\"_blank\" rel=\"noreferrer\">\n      <ImageContent srcLg={srcLg} srcSm={srcSm} label={label} date={date} />\n    </a>\n  )\n};\n\nconst ImageContent = ({srcLg, srcSm, label, date}) => {\n  if (srcSm == null || srcLg == null) {\n    return (<div></div>)\n  }\n  else {\n    const formatted = date;\n    return (\n      <div>\n        <img src={srcSm} href={srcLg} alt={label} />\n        <div id=\"date\">{formatted}</div>\n      </div>\n    )\n  }\n};\n\nconst Sound = ({s3rsc, place, src}) => {\n  if (src == null) {\n    return <div></div>\n  }\n  else {\n    const url = s3rsc(`${place}/aud/${src}`);\n    return (\n      <audio controls><source src={url} type=\"audio/mpeg\"/>Your browser does not support audio!</audio>\n    )\n  }\n};\n\nexport {paintMarker};","let _ = require('underscore');\nlet _cache = {};\nlet _filter_local_places = (p) => window.location.host === \"localhost:3000\" || !p.local;\n\nconst s3 = ({s3}) => {\n\n  const s3rsc = where => `${s3.bucketUrl}/gps/s3/${where}?rev=${(new Date()).getTime()}`;\n\n  const fetchPlaces = () =>\n    _fetchJSON(\"all_rivers\")\n      .then(({places}) => {\n        const dat = _.chain(places)\n          .filter(_filter_local_places)\n          .sortBy(\"disp\")\n          .map((p,i) => _.extend(p, {i}))\n          .reduce(((acc, {disp, id, i}) => _.extend(acc, {[id]:{disp, i, loaded:false}})), {})\n          .value();\n        return Promise.resolve(dat);\n      });\n\n  const loadPlace = (place, paintData) => {\n    if (place != null && _cache[place] == null) {\n      return _fetchJSON(`${place}/info`)\n        .then(json => {\n            _cache[place] = json;\n            _.each(json.layers, layer => \n              fetch(s3rsc(`${place}/geojson/${layer}`))\n                .then((res) => res.json())\n                .then(paintData(layer)));\n            return Promise.resolve({json:json, paint:true});\n        })\n    }\n    else {\n      return Promise.resolve({json:_cache[place], paint:place == null});\n    }\n  };\n\n  const _fetchJSON = which =>\n    fetch(s3rsc(`${which}.json`))\n      .then(res => {\n        if (res.ok) {\n          return(res.json());\n        }\n        else {\n          return Promise.reject(`Unable to fetch ${which}.json`);\n        }\n      });\n  \n  return {s3rsc, fetchPlaces, loadPlace};\n};\n\nexport {s3};","import React, { useRef, useEffect, useState } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport './Map.scss';\nimport Menu from './Menu';\nimport Legend from './Legend';\nimport {paintMarker} from './Marker'\nimport {s3} from './S3';\nlet _ = require('underscore');\n\nconst colorWaterMarker = '#2592ff';\nconst colorNonWaterMarker = '#ff2592';\nconst colorPoly = '#ff0000';\nconst colorRiver = '#00bcff';\nconst colorTrack = '#ff2592';\n\nconst paintPoly = { 'line-color': colorPoly, 'line-width': 2, 'line-opacity':0.25 };\nconst paintTrack = { 'line-color': colorTrack, 'line-width': 2, 'line-opacity':0.6} ;\nconst paintRivers = sm => ({ 'line-color': colorRiver, 'line-width': (sm ? 1 : 2), 'line-opacity': (sm ? 0.6 : 1.0)} );\n\nconst hashToPlace = () => window.location.hash.split(\"#\")[1];\n\nconst Map = ({config}) => {\n  mapboxgl.accessToken = config.map.accessToken;\n  const {s3rsc, loadPlace, fetchPlaces} = s3(config);\n\n  const fetchPlacesRef = useRef(fetchPlaces);\n  const map = useRef(null);\n  const tipRef = useRef(null);\n  const mapContainerRef = useRef(null);\n  const attributionRef = useRef(config.map.attribution);\n  const styleRef = useRef(config.map.mapStyle);\n  const centerRef = useRef(config.map.center);\n  const zoomRef = useRef(config.map.zoom);\n  \n  const [places, setPlaces] = useState(null);\n  const [legendVisible, setLegendVisible] = useState(false);\n  const [error, setError] = useState(null);\n  const [modalHtml, setModalHtml] = useState(null);\n  const [desc, setDesc] = useState(null);\n  \n  const paintPlaceRef = useRef((place, initialPlaces) => {\n    const paintData = place => lID0 => data => {\n      if (place == null) return;\n      const lID1 = `layer-${place}-${lID0}`;\n      map.current.addSource(lID1, {\n        type: 'geojson',\n        data: data\n      });\n    \n      const kinds = lID0.replace(\".geojson\", \"\").split(\"-\");\n      addPoints(lID1, kinds);\n      addPolys(lID1);\n      addLines(lID1, kinds);\n    };\n    \n    const addPoints = (lID0, kinds) => {\n      const isWaterMarker = kinds.indexOf(\"cenote\") !== -1 || kinds.indexOf(\"river\") !== -1;\n      const lID1 = `${lID0}-points`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'circle',\n        'source': lID0,\n        'paint': {\n        'circle-radius': 6,\n        'circle-color': (isWaterMarker ? colorWaterMarker : colorNonWaterMarker)\n        },\n        'filter': ['==', '$type', 'Point']\n      });\n      addListeners(lID1);\n    };\n    \n    const addListeners = lID => {\n      map.current.on('mousemove', lID, drawTooltip);\n      map.current.on('click', lID, drawDescription);\n      map.current.on('mouseleave', lID, () => map.current.fire('closeAllPopups'));\n    };\n    \n    const drawDescription = ({lngLat, features}) => {\n      setModalHtml(null);\n      if (features.length === 0 ) return;\n      \n      const content = features[0].properties.description;\n      if (content !== undefined && content.length > 0) {\n        setModalHtml(content);\n      }\n      else {\n        drawTooltip({lngLat, features});\n      }\n    };\n    \n    const drawTooltip = ({lngLat, features}) => {\n      if (features.length === 0 ) return;\n    \n      if (tipRef.current != null) {\n        tipRef.current.remove();\n      }\n      const ft = features[0];\n      const coord = ft.geometry.type === \"Point\" ? ft.geometry.coordinates : lngLat.wrap();\n      \n      const el = document.createElement('div');\n      el.textContent = ft.properties.name;\n    \n      tipRef.current = new mapboxgl.Popup({offset: [0, -15]})\n        .setLngLat(coord)\n        .setDOMContent(el)\n        .addTo(map.current);\n    \n      el.parentNode.parentNode.className += ' tip';\n    \n      map.current.on('closeAllPopups', () => { \n        if (tipRef.current != null) {\n          tipRef.current.remove();\n        }\n      });\n    };\n    \n    const addPolys = lID0 => {\n      map.current.addLayer({\n        'id':  `${lID0}-outline`,\n        'type': 'line',\n        'source': lID0,\n        'paint': paintPoly,\n        'filter': ['==', '$type', 'Polygon']\n      });\n      const lID1 = `${lID0}-area`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'fill',\n        'source': lID0,\n        'paint': {\n          'fill-color': colorPoly,\n          'fill-opacity': 0.1\n        },\n        'filter': ['==', '$type', 'Polygon']\n      });\n      addListeners(lID1);\n    };\n    \n    const addLines = (lID0, kinds) => {\n      const isTrack = kinds.indexOf(\"track\") !== -1;\n      const isSmRiver = kinds.indexOf(\"sm\") !== -1;\n      const lID1 = `${lID0}-lines`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'line',\n        'source': lID0,\n        'layout': {\n          'line-join': 'round',\n          'line-cap': 'round'\n        },\n        'paint': (isTrack ? paintTrack : paintRivers(isSmRiver)),\n        'filter': ['==', '$type', 'LineString']\n      });\n      addListeners(lID1);\n    };\n\n    return loadPlace(place, paintData(place, setModalHtml))\n      .then(({json, paint}) => {\n        if (paint) {\n          // first time setting places, hash indicates no place in particular\n          if (place == null && initialPlaces != null)\n            setPlaces(initialPlaces);\n          else {\n            // hash indicates a specific place, may be first load or not\n            setPlaces(prev0 => {\n              const prev1 = prev0 || initialPlaces;\n              return ({...prev1, [place]:({...prev1[place], loaded:true})})\n            });\n            if (json != null) _.each(json.locations, paintMarker(s3rsc, map.current, place, setModalHtml));\n          }\n        }\n        if (json == null)\n          setDesc(null);\n        else {\n          const pos = _.findWhere(json.locations, {\"label\":json.center}).loc;\n          map.current.flyTo({center:[pos.lng, pos.lat], zoom: json.zoom});\n          setDesc(json.desc);\n        }\n        setError(null);\n        setLegendVisible(true);\n      })\n      .catch(() => setError(\"That place does not exist.\"))\n    });\n\n  // Initialize map when component mounts\n  useEffect(() => {\n    if (map.current) return;\n\n    map.current = new mapboxgl.Map({\n        container: mapContainerRef.current,\n        style: styleRef.current,\n        attributionControl: false,\n        center: centerRef.current,\n        zoom: zoomRef.current\n      })\n      .addControl(\n        new mapboxgl.GeolocateControl({\n          positionOptions: {\n          enableHighAccuracy: true\n        },\n        trackUserLocation: true,\n        showUserHeading: true\n        })\n      )\n      .addControl(new mapboxgl.AttributionControl({compact: true, customAttribution: attributionRef.current}))\n      .addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}))\n      .addControl(new mapboxgl.NavigationControl(), 'top-right')\n      .once('load', () => {\n        fetchPlacesRef.current().then((res) => {\n          if (res == null) setError(\"Could not fetch places.\")\n          else {\n            const doLoad = initialPlaces => {\n              let curr = hashToPlace();\n              paintPlaceRef.current(curr, initialPlaces);\n            }\n            doLoad(res);\n            window.onhashchange = () => doLoad();\n          }\n        });\n      });\n\n    // Clean up on unmount\n    return () => map.current.remove();\n  }, []);\n\n  return (\n    <div>\n      <div id=\"my-controls\">\n        <Menu places={places} />\n        <Legend visible={legendVisible} colorRiver={colorRiver} colorTrack={colorTrack} />\n      </div>\n      <Error message={error} />\n      <Desc html={desc} />\n      <div className='map-container' ref={mapContainerRef} />\n      <Modal html={modalHtml} close={()=>setModalHtml(null)} />\n    </div>\n  );\n};\n\nconst Error = ({message}) => {\n  if (message != null) {\n    return (\n      <div id=\"center-message\">\n        <div id=\"message-container\">\n          <div id=\"message\">{message}</div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Desc = ({html}) => {\n  if (html != null) {\n    return (\n      <div id=\"desc-container\">\n        <div id=\"desc\" dangerouslySetInnerHTML={{ __html: html }}></div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Modal = ({html, close}) => {\n  if (html != null) {\n    return (\n      <div id=\"modal-container\">\n        <div id=\"scroller\">\n          <div id=\"modal\">\n            <span className=\"material-icons close\" onClick={close}>close</span>\n            <div id=\"content\" dangerouslySetInnerHTML={{ __html: html }}></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nexport default Map;\n","const config = {\n    site: {\n        title: \"Rivers of CA\"\n    },\n    s3: {\n        bucketUrl : \"https://s3-us-west-2.amazonaws.com/multimap-2\"\n    },\n    map : {\n        accessToken : \"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A\",\n        mapStyle : \"mapbox://styles/edoardschooner/cku8yh0id5za818rmtnwt7zzo\",\n        center: [-119.509444, 37.229722],\n        zoom: 5,\n        attribution : `Â© Wes Jackson ${new Date().getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`\n    }\n}\n\nexport {config};","import React from 'react';\nimport Map from './Map';\nimport {config} from './Config';\n\nfunction App() {\n  return (\n    <div>\n      <title>{config.site.title}</title>\n      <Map config={config}/>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}