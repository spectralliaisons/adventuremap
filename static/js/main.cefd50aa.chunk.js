(this.webpackJsonpmultimap=this.webpackJsonpmultimap||[]).push([[0],{12:function(e,t,c){},13:function(e,t,c){},14:function(e,t,c){},17:function(e,t,c){},20:function(e,t,c){"use strict";c.r(t);var n=c(2),s=c.n(n),l=c(6),r=c.n(l),o=(c(12),c(3)),i=c.n(o),a=(c(13),c(14),c(0));let d=c(5);const j=({menuState:e,toggle:t})=>Object(a.jsxs)("div",{id:"hamburger",className:e,onClick:t,children:[Object(a.jsx)("span",{}),Object(a.jsx)("span",{}),Object(a.jsx)("span",{}),Object(a.jsx)("span",{})]}),u=({menuState:e,places:t})=>{const c=d.chain(t).keys().map((e=>{const c=t[e];return{id:e,disp:c.disp,className:c.loaded?"loaded":"unloaded"}})).sortBy("disp").value(),n={height:("open"===e?26*c.length-18+18:0)+"px",padding:"0px 6px 0px 6px"},s={paddingTop:"18px"};return Object(a.jsx)("div",{id:"places",className:e,style:n,children:Object(a.jsx)("ol",{style:s,children:c.map((e=>Object(a.jsx)("div",{children:Object(a.jsx)(p,{id:e.id,className:e.className,disp:e.disp})},e.id)))})})},p=({id:e,className:t,disp:c})=>Object(a.jsx)("li",{id:e,className:t,style:{fontSize:"14px"},children:Object(a.jsx)("a",{href:"#"+e,children:c})});var m=({places:e})=>{const[t,c]=Object(n.useState)("loading");return"loading"===t&&d.size(e)>0&&c("open"),Object(a.jsxs)("div",{id:"menu",className:t,children:[Object(a.jsx)(j,{menuState:t,toggle:function(){c("open"===t?"closed":"open")}}),Object(a.jsx)(u,{menuState:t,places:e})]})};c(17);const b=({color:e})=>Object(a.jsx)("svg",{width:"35px",children:Object(a.jsx)("circle",{r:"5",cx:"13",cy:"13",fill:e})}),h=({color:e})=>Object(a.jsx)("svg",{width:"35px",children:Object(a.jsx)("line",{x1:"0",x2:"25",y1:"13",y2:"13",stroke:e})});var x=({visible:e,colorRiver:t,colorTrack:c})=>e?Object(a.jsxs)("div",{id:"legend",children:[Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)("div",{id:"eg-aud",className:"eg-marker"}),Object(a.jsx)("span",{children:"sound"})]}),Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)("div",{id:"eg-img",className:"eg-marker"}),Object(a.jsx)("span",{children:"photo"})]}),Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)(b,{color:t}),Object(a.jsx)("span",{children:"water feature"})]}),Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)(b,{color:c}),Object(a.jsx)("span",{children:"human feature"})]}),Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)(b,{color:"#000000"}),Object(a.jsx)("span",{children:"other feature"})]}),Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)(h,{color:t}),Object(a.jsx)("span",{children:"river"})]}),Object(a.jsxs)("div",{className:"item",children:[Object(a.jsx)(h,{color:c}),Object(a.jsx)("span",{children:"my route"})]})]}):Object(a.jsx)("div",{}),O=c(7),f=c.n(O);c(19);const g=e=>{let t=document.createElement("div");return null!=e.aud?t.className="marker-aud":null!=e.img&&(t.className="marker-img"),t},v=({s3rsc:e,place:t,location:c})=>{const n=c.label||"",s=c.img?e(`${t}/imgLg/${c.img}`):null,l=c.img?e(`${t}/imgSm/${c.img}`):null,r=c.date?c.date.split(" ")[0].replaceAll(":","."):null;return Object(a.jsxs)("div",{children:[Object(a.jsx)(y,{location:c}),Object(a.jsx)("h3",{children:n}),Object(a.jsx)(w,{srcLg:s,srcSm:l,label:n,date:r}),Object(a.jsx)(N,{s3rsc:e,place:t,src:c.aud})]})},y=({location:e})=>{const t=e.loc.lat.toFixed(4),c=e.loc.lng.toFixed(4),n=`https://www.google.com/maps/search/?api=1&query=${e.loc.lat},${e.loc.lng}`;return Object(a.jsxs)("div",{className:"icon link",children:[Object(a.jsx)("span",{className:"material-icons",children:"map"}),Object(a.jsxs)("a",{href:n,target:"_",children:[t,",",c]})]})},w=({srcLg:e,srcSm:t,label:c,date:n})=>Object(a.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:Object(a.jsx)(k,{srcLg:e,srcSm:t,label:c,date:n})}),k=({srcLg:e,srcSm:t,label:c,date:n})=>{if(null==t||null==e)return Object(a.jsx)("div",{});{const s=n;return Object(a.jsxs)("div",{children:[Object(a.jsx)("img",{src:t,href:e,alt:c}),Object(a.jsx)("div",{id:"date",children:s})]})}},N=({s3rsc:e,place:t,src:c})=>{if(null==c)return Object(a.jsx)("div",{});{const n=e(`${t}/aud/${c}`);return Object(a.jsxs)("audio",{controls:!0,children:[Object(a.jsx)("source",{src:n,type:"audio/mpeg"}),"Your browser does not support audio!"]})}};let $=c(5),S={},L=e=>"localhost:3000"===window.location.host||!e.local;let C=c(5);const P="#ff0000",R="#00bcff",T="#ff2592",z={"line-color":P,"line-width":2,"line-opacity":.25},_={"line-color":T,"line-width":2,"line-opacity":.6},A=({message:e})=>null!=e?Object(a.jsx)("div",{id:"center-message",children:Object(a.jsx)("div",{id:"message-container",children:Object(a.jsx)("div",{id:"message",children:e})})}):Object(a.jsx)("div",{}),J=({html:e})=>null!=e?Object(a.jsx)("div",{id:"desc-container",children:Object(a.jsx)("div",{id:"desc",dangerouslySetInnerHTML:{__html:e}})}):Object(a.jsx)("div",{}),M=({html:e,close:t})=>null!=e?Object(a.jsx)("div",{id:"modal-container",children:Object(a.jsx)("div",{id:"scroller",children:Object(a.jsxs)("div",{id:"modal",children:[Object(a.jsx)("span",{className:"material-icons close",onClick:t,children:"close"}),Object(a.jsx)("div",{id:"content",dangerouslySetInnerHTML:{__html:e}})]})})}):Object(a.jsx)("div",{});var I=({config:e})=>{i.a.accessToken=e.map.accessToken;const{s3rsc:t,loadPlace:c,fetchPlaces:s}=(({s3:e})=>{const t=t=>`${e.bucketUrl}/gps/s3/${t}?rev=${(new Date).getTime()}`,c=e=>fetch(t(`${e}.json`)).then((t=>t.ok?t.json():Promise.reject(`Unable to fetch ${e}.json`)));return{s3rsc:t,fetchPlaces:()=>c("all_rivers").then((({places:e})=>{const t=$.chain(e).filter(L).sortBy("disp").map(((e,t)=>$.extend(e,{i:t}))).reduce(((e,{disp:t,id:c,i:n})=>$.extend(e,{[c]:{disp:t,i:n,loaded:!1}})),{}).value();return Promise.resolve(t)})),loadPlace:(e,n)=>null!=e&&null==S[e]?c(`${e}/info`).then((c=>(S[e]=c,$.each(c.layers,(c=>fetch(t(`${e}/geojson/${c}`)).then((e=>e.json())).then(n(c)))),Promise.resolve({json:c,paint:!0})))):Promise.resolve({json:S[e],paint:null==e})}})(e),l=Object(n.useRef)(s),r=Object(n.useRef)(null),o=Object(n.useRef)(null),d=Object(n.useRef)(null),j=Object(n.useRef)(e.map.attribution),u=Object(n.useRef)(e.map.mapStyle),p=Object(n.useRef)(e.map.center),b=Object(n.useRef)(e.map.zoom),[h,O]=Object(n.useState)(null),[y,w]=Object(n.useState)(!1),[k,N]=Object(n.useState)(null),[I,D]=Object(n.useState)(null),[E,F]=Object(n.useState)(null),H=Object(n.useRef)(((e,n)=>{const s=(e,t)=>{const c=-1!==t.indexOf("cenote")||-1!==t.indexOf("river"),n=`${e}-points`;r.current.addLayer({id:n,type:"circle",source:e,paint:{"circle-radius":6,"circle-color":c?"#2592ff":"#ff2592"},filter:["==","$type","Point"]}),l(n)},l=e=>{r.current.on("mousemove",e,j),r.current.on("click",e,d),r.current.on("mouseleave",e,(()=>r.current.fire("closeAllPopups")))},d=({lngLat:e,features:t})=>{if(D(null),0===t.length)return;const c=t[0].properties.description;void 0!==c&&c.length>0?D(c):j({lngLat:e,features:t})},j=({lngLat:e,features:t})=>{if(0===t.length)return;null!=o.current&&o.current.remove();const c=t[0],n="Point"===c.geometry.type?c.geometry.coordinates:e.wrap(),s=document.createElement("div");s.textContent=c.properties.name,o.current=new i.a.Popup({offset:[0,-15]}).setLngLat(n).setDOMContent(s).addTo(r.current),s.parentNode.parentNode.className+=" tip",r.current.on("closeAllPopups",(()=>{null!=o.current&&o.current.remove()}))},u=e=>{r.current.addLayer({id:`${e}-outline`,type:"line",source:e,paint:z,filter:["==","$type","Polygon"]});const t=`${e}-area`;r.current.addLayer({id:t,type:"fill",source:e,paint:{"fill-color":P,"fill-opacity":.1},filter:["==","$type","Polygon"]}),l(t)},p=(e,t)=>{const c=-1!==t.indexOf("track"),n=-1!==t.indexOf("sm"),s=`${e}-lines`;var o;r.current.addLayer({id:s,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:c?_:(o=n,{"line-color":R,"line-width":o?1:2,"line-opacity":o?.6:1}),filter:["==","$type","LineString"]}),l(s)};return c(e,(e=>t=>c=>{if(null==e)return;const n=`layer-${e}-${t}`;r.current.addSource(n,{type:"geojson",data:c});const l=t.replace(".geojson","").split("-");s(n,l),u(n),p(n,l)})(e)).then((({json:c,paint:s})=>{if(s&&(null==e&&null!=n?O(n):(O((t=>{const c=t||n;return{...c,[e]:{...c[e],loaded:!0}}})),null!=c&&C.each(c.locations,((e,t,c,n)=>s=>{const l=document.createElement("div"),r=new i.a.Popup({className:"media",closeOnClick:!0,offset:25}).setDOMContent(l);new i.a.Marker(g(s)).setLngLat([s.loc.lng,s.loc.lat]).setPopup(r).addTo(t);const o=f.a.renderToString(Object(a.jsx)(v,{s3rsc:e,place:c,location:s}));r.on("open",(()=>n(o)))})(t,r.current,e,D)))),null==c)F(null);else{const e=C.findWhere(c.locations,{label:c.center}).loc;r.current.flyTo({center:[e.lng,e.lat],zoom:c.zoom}),F(c.desc)}N(null),w(!0)})).catch((()=>N("That place does not exist.")))}));return Object(n.useEffect)((()=>{if(!r.current)return r.current=new i.a.Map({container:d.current,style:u.current,attributionControl:!1,center:p.current,zoom:b.current}).addControl(new i.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})).addControl(new i.a.AttributionControl({compact:!0,customAttribution:j.current})).addControl(new i.a.FullscreenControl({container:document.querySelector("body")})).addControl(new i.a.NavigationControl,"top-right").once("load",(()=>{l.current().then((e=>{if(null==e)N("Could not fetch places.");else{const t=e=>{let t=window.location.hash.split("#")[1];H.current(t,e)};t(e),window.onhashchange=()=>t()}}))})),()=>r.current.remove()}),[]),Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{id:"my-controls",children:[Object(a.jsx)(m,{places:h}),Object(a.jsx)(x,{visible:y,colorRiver:R,colorTrack:T})]}),Object(a.jsx)(A,{message:k}),Object(a.jsx)(J,{html:E}),Object(a.jsx)("div",{className:"map-container",ref:d}),Object(a.jsx)(M,{html:I,close:()=>D(null)})]})};const D={site:{title:"Rivers of CA"},s3:{bucketUrl:"https://s3-us-west-2.amazonaws.com/multimap-2"},map:{accessToken:"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A",mapStyle:"mapbox://styles/edoardschooner/cku8yh0id5za818rmtnwt7zzo",center:[-119.509444,37.229722],zoom:5,attribution:`\xa9 Wes Jackson ${(new Date).getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`}};var E=function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("title",{children:D.site.title}),Object(a.jsx)(I,{config:D})]})};r.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(E,{})}),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.cefd50aa.chunk.js.map