{"version":3,"sources":["Menu.js","Legend.js","Marker.js","S3.js","Navigation.js","Map.js","Config.js","App.js","index.js"],"names":["Hamburger","menuState","toggle","id","className","onClick","Places","paintPlace","places","placesStyl","height","length","padding","olStyl","paddingTop","style","map","disp","Item","closeMenu","loaded","setLoaded","useState","fontSize","then","Menu","setMenuState","Point","color","width","r","cx","cy","fill","Line","x1","x2","y1","y2","stroke","Legend","visible","colorRiver","colorTrack","styledMarker","location","marker","document","createElement","aud","img","Window","s3rsc","place","label","srcLg","srcSm","date","split","replaceAll","Location","Image","Sound","src","lat","loc","toFixed","lng","url","href","target","rel","ImageContent","formatted","alt","controls","type","_","require","_cache","_filter_local_places","p","window","host","local","to","setError","hash","curr","el","getElementById","out","connect","cbs","onhashchange","setHash","colorPoly","tip","addPoints","layer","kinds","setModalHtml","isWaterMarker","indexOf","lID","addLayer","addListeners","on","drawTooltip","drawDescription","fire","lngLat","features","undefined","content","properties","description","remove","ft","coord","geometry","coordinates","wrap","textContent","name","mapboxgl","Popup","offset","setLngLat","setDOMContent","addTo","parentNode","addLines","isTrack","isSmRiver","paintTrack","paintRivers","addPolys","paintPoly","sm","Error","message","Desc","html","dangerouslySetInnerHTML","__html","Modal","close","Map","config","loadPlace","fetchPlaces","s3","where","bucketUrl","Date","getTime","_fetchJSON","which","fetch","res","ok","json","Promise","reject","_loadLayer","paintData","dat","chain","filter","sortBy","value","resolve","each","layers","paint","accessToken","mapContainerRef","useRef","setMap","setPlaces","legendVisible","setLegendVisible","error","modalHtml","desc","setDesc","m","success","fail","data","addSource","replace","zoom","locations","center","pos","findWhere","flyTo","moveTo","popup","closeOnClick","Marker","setPopup","ReactDomServer","renderToString","paintMarker","catch","doPaintPlace","Nav","useEffect","container","current","mapStyle","attributionControl","addControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","showUserHeading","AttributionControl","compact","customAttribution","attribution","FullscreenControl","querySelector","NavigationControl","once","ref","site","title","getFullYear","App","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.450fcb55.chunk.js","sourcesContent":["import React, {useState} from 'react';\nimport './Menu.scss';\n\nconst fontSz = 14;\nconst padding = 6;\nconst listPaddingTop = 18;\n\nconst Menu = ({paintPlace, places}) => {\n\n    const [menuState, setMenuState] = useState(\"loading\");\n\n    if (menuState === \"loading\" && places.length > 0) {setMenuState(\"open\");}\n\n    function toggle() {\n        if (menuState === \"open\") {setMenuState(\"closed\");} \n        else {setMenuState(\"open\");}\n    }\n\n    return (\n        <div id='menu' className={menuState}>\n            <Hamburger menuState={menuState} toggle={toggle}/>\n            <Places menuState={menuState} paintPlace={paintPlace} places={places} toggle={toggle}/>\n        </div>\n    );\n};\n\nconst Hamburger = ({menuState, toggle}) => {\n    return (\n        <div id=\"hamburger\" className={menuState} onClick={toggle}>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </div>\n    )\n};\n\nconst Places = ({menuState, paintPlace, places, toggle}) => {\n    const placesStyl = {\n        height:`${(menuState === \"open\" ? (places.length*(fontSz+padding*2)-padding*3+listPaddingTop) : 0)}px`,\n        padding: `0px ${padding}px 0px ${padding}px`\n    };\n    const olStyl = {paddingTop: `${listPaddingTop}px`};\n    return (\n        <div id=\"places\" className={menuState} style={placesStyl}>\n            <ol style={olStyl}>{places.map(({disp,id}) => \n                <div key={id}>\n                    <Item paintPlace={paintPlace} closeMenu={toggle} disp={disp} id={id}/>\n                </div>\n            )}</ol>\n        </div>\n    )\n};\n\nconst Item = ({paintPlace, closeMenu, disp, id}) => {\n    const [loaded, setLoaded] = useState(\"unloaded\");\n\n    function fetch() {\n        paintPlace(id).then(() => {\n            setLoaded(\"loaded\");\n            closeMenu();\n        });\n    }\n\n    return (\n        <li id={id} className={loaded} style={{fontSize:`${fontSz}px`}} onClick={fetch}>{disp}</li>\n    );\n};\n\nexport default Menu;\n","import React from 'react';\nimport './Legend.scss';\n\nconst Legend = ({visible, colorRiver, colorTrack}) => {\n    if (visible) {\n        return (\n            <div id=\"legend\">\n                <div className=\"item\">\n                    <div id=\"eg-aud\" className=\"eg-marker\"/>\n                    <span>sound</span>\n                </div>\n                <div className=\"item\">\n                    <div id=\"eg-img\" className=\"eg-marker\"/>\n                    <span>photo</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={colorRiver}/>\n                    <span>water feature</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={colorTrack}/>\n                    <span>human feature</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={\"#000000\"}/>\n                    <span>other feature</span>\n                </div>\n                <div className=\"item\">\n                    <Line color={colorRiver}/>\n                    <span>river</span>\n                </div>\n                <div className=\"item\">\n                    <Line color={colorTrack}/>\n                    <span>my route</span>\n                </div>\n            </div>\n        )\n    }\n    else {\n        return <div></div>\n    }\n};\n\nconst Point = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <circle r=\"5\" cx=\"13\" cy=\"13\" fill={color}></circle>\n        </svg>\n    )\n};\n\nconst Line = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <line x1=\"0\" x2=\"25\" y1=\"13\" y2=\"13\" stroke={color}></line>\n        </svg>\n    )\n};\n\nexport default Legend;","import ReactDomServer from 'react-dom/server'\nimport mapboxgl from 'mapbox-gl';\nimport 'material-icons/iconfont/material-icons.css';\n\nconst paintMarker = (s3rsc, map, place, setModalHtml) => location => {\n  const el = document.createElement('div');\n\n  const popup = new mapboxgl.Popup({ \n    className: 'media', \n    closeOnClick: true,\n    offset: 25 \n  }).setDOMContent(el);\n\n  new mapboxgl.Marker(styledMarker(location))\n    .setLngLat([location.loc.lng, location.loc.lat])\n    .setPopup(popup)\n    .addTo(map);\n\n  const html = ReactDomServer.renderToString(<Window s3rsc={s3rsc} place={place} location={location}/>);\n  popup.on('open', () => setModalHtml(html));\n};\n\nconst styledMarker = location => {\n  let marker = document.createElement('div');\n  if (location.aud != null) {marker.className = 'marker-aud';}\n  else if (location.img != null) {marker.className = 'marker-img';}\n  return marker;\n};\n\nconst Window = ({s3rsc, place, location}) => {\n  const label = location.label || \"\";\n  const srcLg = location.img ? s3rsc(`${place}/imgLg/${location.img}`) : null;\n  const srcSm = location.img ? s3rsc(`${place}/imgSm/${location.img}`) : null;\n  const date = location.date ? location.date.split(\" \")[0].replaceAll(\":\", \".\") : null;\n  return (\n      <div>\n        <Location location={location}/>\n        <h3>{label}</h3>\n        <Image srcLg={srcLg} srcSm={srcSm} label={label} date={date} />\n        <Sound s3rsc={s3rsc} place={place} src={location.aud} />\n      </div>\n  );\n};\n\nconst Location = ({location}) => {\n  const lat = location.loc.lat.toFixed(4);\n  const lng = location.loc.lng.toFixed(4);\n  const url = `https://www.google.com/maps/search/?api=1&query=${location.loc.lat},${location.loc.lng}`;\n  return <div className=\"icon link\"><span className=\"material-icons\">map</span><a href={url} target=\"_\">{lat},{lng}</a></div>\n};\n\nconst Image = ({srcLg, srcSm, label, date}) => {\n  return (\n    <a href={srcLg} target=\"_blank\" rel=\"noreferrer\">\n      <ImageContent srcLg={srcLg} srcSm={srcSm} label={label} date={date} />\n    </a>\n  )\n};\n\nconst ImageContent = ({srcLg, srcSm, label, date}) => {\n  if (srcSm == null || srcLg == null) {\n    return (<div></div>)\n  }\n  else {\n    const formatted = date;\n    return (\n      <div>\n        <img src={srcSm} href={srcLg} alt={label} />\n        <div id=\"date\">{formatted}</div>\n      </div>\n    )\n  }\n};\n\nconst Sound = ({s3rsc, place, src}) => {\n  if (src == null) {\n    return <div></div>\n  }\n  else {\n    const url = s3rsc(`${place}/aud/${src}`);\n    return (\n      <audio controls><source src={url} type=\"audio/mpeg\"/>Your browser does not support audio!</audio>\n    )\n  }\n};\n\nexport {paintMarker};","let _ = require('underscore');\nlet _cache = {};\nlet _filter_local_places = (p) => window.location.host === \"localhost:3000\" || !p.local;\n\nconst s3 = ({s3}) => {\n\n  const s3rsc = where => `${s3.bucketUrl}/gps/s3/${where}?rev=${(new Date()).getTime()}`;\n\n  const fetchPlaces = () =>\n    _fetchJSON(\"all_rivers\")\n      .then(({places}) => {\n        const dat = _.chain(places)\n          .filter(_filter_local_places)\n          .sortBy(\"disp\")\n          .value();\n        return Promise.resolve(dat);\n      });\n\n  const loadPlace = (place, paintData) => {\n    if (_cache[place] == null) {\n      return _fetchJSON(`${place}/info`)\n        .then(json => {\n            _cache[place] = json;\n            _.each(json.layers, _loadLayer(place, paintData));\n            return Promise.resolve({json:json, paint:true});\n        })\n    }\n    else {\n      return Promise.resolve({json:_cache[place], paint:false});\n    }\n  };\n\n  const _fetchJSON = which =>\n    fetch(s3rsc(`${which}.json`))\n      .then(res => {\n        if (res.ok) {\n          return(res.json());\n        }\n        else {\n          return Promise.reject(`Unable to fetch ${which}.json`);\n        }\n      });\n\n  const _loadLayer = (place, paintData) => layer => \n    fetch(s3rsc(`${place}/geojson/${layer}`))\n      .then((res) => res.json())\n      .then(paintData(layer));\n  \n  return {s3rsc, fetchPlaces, loadPlace};\n};\n\nexport {s3};","const to = ({paintPlace, setError}, hash) => {\n    let curr = null;\n    if (curr = hash.split(\"#\")[1]) {\n        paintPlace(curr).then(() => {\n            let el = null;\n            if (el = document.getElementById(curr)) {\n                el.className = \"loaded\";\n                setError(null);\n            }\n        })\n    }\n};\n\nconst out = {\n    connect : cbs => {\n        // If the url currently indicates a place, load it\n        to(cbs, window.location.hash);\n    \n        window.onhashchange = () => {\n            to(cbs, window.location.hash);\n        }\n    },\n    setHash : (place) => window.location.hash = place\n};\n\nexport default out;","import React, { useRef, useEffect, useState } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport './Map.scss';\nimport Menu from './Menu';\nimport Legend from './Legend';\nimport {paintMarker} from './Marker'\nimport {s3} from './S3';\nimport Nav from './Navigation';\nlet _ = require('underscore');\n\nconst colorWaterMarker = '#2592ff';\nconst colorNonWaterMarker = '#ff2592';\nconst colorPoly = '#ff0000';\nconst colorRiver = '#00bcff';\nconst colorTrack = '#ff2592';\n\nlet tip = null;\n\nconst moveTo = (map, {zoom, locations, center}) => {\n  const pos = _.findWhere(locations, {\"label\":center}).loc;\n  map.flyTo({center:[pos.lng, pos.lat], zoom: zoom});\n};\n\n// paint geojson data\nconst paintData = (map, place, setModalHtml) => layer => data => {\n  const lID = `layer-${place}-${layer}`;\n  map.addSource(lID, {\n    type: 'geojson',\n    data: data\n  });\n\n  const kinds = layer.replace(\".geojson\", \"\").split(\"-\");\n  addPoints(map, lID, kinds, setModalHtml);\n  addPolys(map, lID, setModalHtml);\n  addLines(map, lID, kinds);\n};\n\nconst addPoints = (map, layer, kinds, setModalHtml) => {\n  const isWaterMarker = kinds.indexOf(\"cenote\") !== -1 || kinds.indexOf(\"river\") !== -1;\n  const lID = `${layer}-points`;\n  map.addLayer({\n    'id': lID,\n    'type': 'circle',\n    'source': layer,\n    'paint': {\n    'circle-radius': 6,\n    'circle-color': (isWaterMarker ? colorWaterMarker : colorNonWaterMarker)\n    },\n    'filter': ['==', '$type', 'Point']\n  });\n  addListeners(map, lID, setModalHtml);\n};\n\nconst addListeners = (map, lID, setModalHtml) => {\n  map.on('mousemove', lID, drawTooltip(map, lID));\n  map.on('click', lID, drawDescription(map, lID, setModalHtml));\n  map.on('mouseleave', lID, () => map.fire('closeAllPopups'));\n};\n\nconst drawDescription = (map, lID, setModalHtml) => ({ lngLat, features }) => {\n  if (setModalHtml !== undefined) setModalHtml(null);\n  if (features.length === 0 ) return;\n  \n  const content = features[0].properties.description;\n  if (content !== undefined && content.length > 0) {\n    if (setModalHtml !== undefined) setModalHtml(content);\n  }\n  else {\n    drawTooltip(map, lID)({lngLat, features});\n  }\n};\n\nconst drawTooltip = (map, lID) => ({ lngLat, features }) => {\n  if (features.length === 0 ) return;\n\n  if (tip != null) {\n    tip.remove();\n    tip = null;\n  }\n  const ft = features[0];\n  const coord = ft.geometry.type === \"Point\" ? ft.geometry.coordinates : lngLat.wrap();\n  \n  const el = document.createElement('div');\n  el.textContent = ft.properties.name;\n\n  tip = new mapboxgl.Popup({offset: [0, -15]})\n    .setLngLat(coord)\n    .setDOMContent(el)\n    .addTo(map);\n\n  el.parentNode.parentNode.className += ' tip';\n\n  map.on('closeAllPopups', () => { \n    if (tip != null) {\n      tip.remove();\n    }\n    tip = null;\n  });\n};\n\nconst addLines = (map, layer, kinds) => {\n  const isTrack = kinds.indexOf(\"track\") !== -1;\n  const isSmRiver = kinds.indexOf(\"sm\") !== -1;\n  const lID = `${layer}-lines`;\n  map.addLayer({\n    'id': lID,\n    'type': 'line',\n    'source': layer,\n    'layout': {\n      'line-join': 'round',\n      'line-cap': 'round'\n    },\n    'paint': (isTrack ? paintTrack : paintRivers(isSmRiver)),\n    'filter': ['==', '$type', 'LineString']\n  });\n  addListeners(map, lID);\n};\n\nconst addPolys = (map, layer, setModalHtml) => {\n  map.addLayer({\n    'id':  `${layer}-outline`,\n    'type': 'line',\n    'source': layer,\n    'paint': paintPoly,\n    'filter': ['==', '$type', 'Polygon']\n  });\n  const lID = `${layer}-area`;\n  map.addLayer({\n    'id': lID,\n    'type': 'fill',\n    'source': layer,\n    'paint': {\n      'fill-color': colorPoly,\n      'fill-opacity': 0.1\n    },\n    'filter': ['==', '$type', 'Polygon']\n  });\n  addListeners(map, lID, setModalHtml);\n};\n\nconst paintRivers = sm => ({ 'line-color': colorRiver, 'line-width': (sm ? 1 : 2), 'line-opacity': (sm ? 0.6 : 1.0)} );\nconst paintTrack = { 'line-color': colorTrack, 'line-width': 2, 'line-opacity':0.6} ;\nconst paintPoly = { 'line-color': colorPoly, 'line-width': 2, 'line-opacity':0.25 };\n\nconst Map = ({config}) => {\n  const {s3rsc, loadPlace, fetchPlaces} = s3(config);\n  mapboxgl.accessToken = config.map.accessToken;\n\n  const mapContainerRef = useRef(null);\n\n  const [map, setMap] = useState(null);\n  const [places, setPlaces] = useState([]);\n  const [legendVisible, setLegendVisible] = useState(false);\n  const [error, setError] = useState(null);\n  const [modalHtml, setModalHtml] = useState(null);\n  const [desc, setDesc] = useState(null);\n\n  const paintPlace = (m, success, fail) => place => \n    loadPlace(place, paintData(m, place, setModalHtml))\n      .then(({json, paint}) => {\n        moveTo(m, json);\n        if (paint) {\n          _.each(json.locations, paintMarker(s3rsc, m, place, setModalHtml));\n          setDesc(json.desc);\n          success(place);\n        }\n      })\n      .catch(() => fail(\"That place does not exist.\"));\n  \n  const doPaintPlace = (m) => paintPlace(m, (place) => {\n    setError(null);\n    setLegendVisible(true);\n    Nav.setHash(place);\n  }, setError);\n\n  // Initialize map when component mounts\n  useEffect(() => {\n    const map = new mapboxgl.Map({\n        container: mapContainerRef.current,\n        style: config.map.mapStyle,\n        attributionControl: false,\n        center: config.map.center,\n        zoom: config.map.zoom\n      })\n      .addControl(\n        new mapboxgl.GeolocateControl({\n          positionOptions: {\n          enableHighAccuracy: true\n        },\n        trackUserLocation: true,\n        showUserHeading: true\n        })\n      )\n      .addControl(new mapboxgl.AttributionControl({compact: true,customAttribution: config.map.attribution}))\n      .addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}))\n      .addControl(new mapboxgl.NavigationControl(), 'top-right')\n      .once('load', () => fetchPlaces().then((res) => {\n        if (res == null) setError(\"Could not fetch places.\")\n        else {\n          setPlaces(res);\n          setMap(map);\n          Nav.connect({\n            paintPlace:doPaintPlace(map),\n            setError:setError\n          });\n        }\n      }));\n\n    // Clean up on unmount\n    return () => map.remove();\n  }, []); \n\n  return (\n    <div>\n      <div id=\"my-controls\">\n        <Menu paintPlace={doPaintPlace(map)} places={places} />\n        <Legend visible={legendVisible} colorRiver={colorRiver} colorTrack={colorTrack} />\n      </div>\n      <Error message={error} />\n      <Desc html={desc} />\n      <div className='map-container' ref={mapContainerRef} />\n      <Modal html={modalHtml} close={()=>setModalHtml(null)} />\n    </div>\n  );\n};\n\nconst Error = ({message}) => {\n  if (message != null) {\n    return (\n      <div id=\"center-message\">\n        <div id=\"message-container\">\n          <div id=\"message\">{message}</div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Desc = ({html}) => {\n  if (html != null) {\n    return (\n      <div id=\"desc-container\">\n        <div id=\"desc\" dangerouslySetInnerHTML={{ __html: html }}></div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Modal = ({html, close}) => {\n  if (html != null) {\n    return (\n      <div id=\"modal-container\">\n        <div id=\"scroller\">\n          <div id=\"modal\">\n            <span className=\"material-icons close\" onClick={close}>close</span>\n            <div id=\"content\" dangerouslySetInnerHTML={{ __html: html }}></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nexport default Map;\n","const config = {\n    site: {\n        title: \"Rivers of CA\"\n    },\n    s3: {\n        bucketUrl : \"https://s3-us-west-2.amazonaws.com/multimap-2\"\n    },\n    map : {\n        accessToken : \"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A\",\n        mapStyle : \"mapbox://styles/edoardschooner/cku8yh0id5za818rmtnwt7zzo\",\n        center: [-119.509444, 37.229722],\n        zoom: 5,\n        attribution : `© Wes Jackson ${new Date().getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`\n    }\n}\n\nexport {config};","import React from 'react';\nimport Map from './Map';\nimport {config} from './Config';\n\nfunction App() {\n  return (\n    <div>\n      <title>{config.site.title}</title>\n      <Map config={config}/>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}