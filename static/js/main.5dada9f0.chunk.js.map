{"version":3,"sources":["Menu.js","Legend.js","Marker.js","MapStyleControl.js","S3.js","Map.js","Config.js","App.js","index.js"],"names":["_","require","Hamburger","_ref2","menuState","toggle","label","_jsxs","id","className","onClick","title","children","_jsx","Places","_ref3","places","placesLs","chain","keys","map","pID","o","disp","loaded","sortBy","value","placesStyl","height","length","padding","olStyl","paddingTop","style","p","Item","_ref4","fontSize","href","Menu","_ref","setMenuState","useState","size","Point","color","width","r","cx","cy","fill","Line","x1","x2","y1","y2","stroke","Legend","visible","colorRiver","colorTrack","styledMarker","location","marker","document","createElement","aud","img","Window","s3rsc","place","srcLg","srcSm","date","split","replaceAll","Location","Image","Sound","src","lat","loc","toFixed","lng","url","target","rel","ImageContent","formatted","alt","_ref5","controls","type","MapStyleControl","options","setStyleCb","state","setState","setStyle","useEffect","styleLabel","name","MapBoxControl","constructor","this","container","component","onAdd","render","onRemove","parentNode","removeChild","undefined","ReactDOM","_cache","_filter_local_places","window","host","local","colorNonWaterMarker","paintPoly","paintTrack","Error","message","Desc","_ref6","html","dangerouslySetInnerHTML","__html","Modal","_ref7","close","Map","config","mapboxgl","accessToken","loadPlace","fetchPlaces","s3","where","bucketUrl","Date","getTime","_fetchJSON","which","fetch","then","res","ok","json","Promise","reject","dat","filter","i","extend","reduce","acc","resolve","paintData","each","layers","layer","paint","fetchPlacesRef","useRef","mapStyles","hoveredFtRef","selectedFtRef","mapContainerRef","attributionRef","attribution","centerRef","center","zoomRef","zoom","mapData","setPlaces","legendVisible","setLegendVisible","error","setError","modalHtml","setModalHtml","desc","setDesc","paintPlaceRef","initialPlaces","addPoints","lID0","kinds","isWaterMarker","indexOf","lID1","current","addLayer","addListeners","lID","on","drawTooltip","drawDescription","fire","lngLat","features","content","properties","description","ft","geometry","coordinates","wrap","remove","coord","el","textContent","Popup","offset","setLngLat","setDOMContent","addTo","addPolys","addLines","isTrack","isSmRiver","sm","data","addSource","replace","prev0","prev1","locations","paintMarker","popup","closeOnClick","Marker","setPopup","ReactDomServer","renderToString","pos","findWhere","flyTo","catch","s","setHTML","attributionControl","projection","addControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","showUserHeading","AttributionControl","compact","customAttribution","FullscreenControl","querySelector","NavigationControl","once","doLoad","curr","hash","onhashchange","ref","site","getFullYear","App","React","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5dada9f0.chunk.js","sourcesContent":["import React, {useState} from 'react';\nimport './Menu.scss';\nlet _ = require('underscore');\n\nconst fontSz = 14;\nconst padding = 6;\nconst listPaddingTop = 18;\n\nconst Menu = ({places}) => {\n\n    const [menuState, setMenuState] = useState(\"loading\");\n\n    if (menuState === \"loading\" && _.size(places) > 0) {setMenuState(\"open\");}\n\n    function toggle() {\n        if (menuState === \"open\") {setMenuState(\"closed\");} \n        else {setMenuState(\"open\");}\n    }\n\n    return (\n        <div id='menu' className={menuState}>\n            <Hamburger menuState={menuState} toggle={toggle}/>\n            <Places menuState={menuState} places={places} />\n        </div>\n    );\n};\n\nconst Hamburger = ({menuState, toggle}) => {\n    const label = `${menuState === \"open\" ? \"Close\" : \"Open\"} map navigation menu.`;\n    return (\n        <button id=\"hamburger\" className={menuState} onClick={toggle} title={label} aria-label={label}>\n            <span></span>\n            <span></span>\n            <span></span>\n            <span></span>\n        </button>\n    )\n};\n\nconst Places = ({menuState, places}) => {\n    const placesLs = _.chain(places)\n        .keys()\n        .map(pID => {\n            const o = places[pID];\n            return {id:pID, disp:o.disp, className:o.loaded ? \"loaded\" : \"unloaded\"};\n        })\n        .sortBy(\"disp\")\n        .value();\n    const placesStyl = {\n        height:`${(menuState === \"open\" ? (placesLs.length*(fontSz+padding*2)-padding*3+listPaddingTop) : 0)}px`,\n        padding: `0px ${padding}px 0px ${padding}px`\n    };\n    const olStyl = {paddingTop: `${listPaddingTop}px`};\n    return (\n        <div id=\"places\" className={menuState} style={placesStyl}>\n            <ol style={olStyl}>{placesLs.map(p => \n                <div key={p.id}>\n                    <Item id={p.id} className={p.className} disp={p.disp} />\n                </div>\n            )}</ol>\n        </div>\n    )\n};\n\nconst Item = ({id, className, disp}) => {\n    const label = `Show map of ${disp}.`;\n    return (\n        <li id={id} className={className} style={{fontSize:`${fontSz}px`}}><a href={\"#\"+id} title={label} aria-label={label}>{disp}</a></li>\n    );\n};\n\nexport default Menu;\n","import React from 'react';\nimport './Legend.scss';\n\nconst Legend = ({visible, colorRiver, colorTrack}) => {\n    if (visible) {\n        return (\n            <div id=\"legend\">\n                <div className=\"item\">\n                    <div id=\"eg-aud\" className=\"eg-marker\"/>\n                    <span>sound</span>\n                </div>\n                <div className=\"item\">\n                    <div id=\"eg-img\" className=\"eg-marker\"/>\n                    <span>photo</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={colorRiver}/>\n                    <span>water feature</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={colorTrack}/>\n                    <span>human feature</span>\n                </div>\n                <div className=\"item\">\n                    <Point color={\"#000000\"}/>\n                    <span>other feature</span>\n                </div>\n                <div className=\"item\">\n                    <Line color={colorRiver}/>\n                    <span>river</span>\n                </div>\n                <div className=\"item\">\n                    <Line color={colorTrack}/>\n                    <span>my route</span>\n                </div>\n            </div>\n        )\n    }\n    else {\n        return <div></div>\n    }\n};\n\nconst Point = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <circle r=\"5\" cx=\"13\" cy=\"13\" fill={color}></circle>\n        </svg>\n    )\n};\n\nconst Line = ({color}) => {\n    return (\n        <svg width=\"35px\">\n            <line x1=\"0\" x2=\"25\" y1=\"13\" y2=\"13\" stroke={color}></line>\n        </svg>\n    )\n};\n\nexport default Legend;","import ReactDomServer from 'react-dom/server'\nimport mapboxgl from 'mapbox-gl';\nimport 'material-icons/iconfont/material-icons.css';\n\nconst paintMarker = (s3rsc, map, place, setModalHtml) => location => {\n  const el = document.createElement('div');\n\n  const popup = new mapboxgl.Popup({ \n    className: 'media', \n    closeOnClick: true,\n    offset: 25 \n  }).setDOMContent(el);\n\n  const loc = [location.loc.lng, location.loc.lat];\n\n  new mapboxgl.Marker(styledMarker(location))\n    .setLngLat(loc)\n    .setPopup(popup)\n    .addTo(map);\n\n  const html = ReactDomServer.renderToString(<Window s3rsc={s3rsc} place={place} location={location}/>);\n  popup.on('open', () => setModalHtml({loc, html:html}));\n};\n\nconst styledMarker = location => {\n  let marker = document.createElement('div');\n  if (location.aud != null) {marker.className = 'marker-aud';}\n  else if (location.img != null) {marker.className = 'marker-img';}\n  return marker;\n};\n\nconst Window = ({s3rsc, place, location}) => {\n  const label = location.label || \"\";\n  const srcLg = location.img ? s3rsc(`${place}/imgLg/${location.img}`) : null;\n  const srcSm = location.img ? s3rsc(`${place}/imgSm/${location.img}`) : null;\n  const date = location.date ? location.date.split(\" \")[0].replaceAll(\":\", \".\") : null;\n  return (\n      <div>\n        <Location location={location}/>\n        <h3>{label}</h3>\n        <Image srcLg={srcLg} srcSm={srcSm} label={label} date={date} />\n        <Sound s3rsc={s3rsc} place={place} src={location.aud} />\n      </div>\n  );\n};\n\nconst Location = ({location}) => {\n  const lat = location.loc.lat.toFixed(4);\n  const lng = location.loc.lng.toFixed(4);\n  const url = `https://www.google.com/maps/search/?api=1&query=${location.loc.lat},${location.loc.lng}`;\n  return <div className=\"icon\"><span className=\"material-icons\">map</span><a href={url} target=\"_\">{lat},{lng}</a></div>\n};\n\nconst Image = ({srcLg, srcSm, label, date}) => {\n  return (\n    <a href={srcLg} target=\"_blank\" rel=\"noreferrer\">\n      <ImageContent srcLg={srcLg} srcSm={srcSm} label={label} date={date} />\n    </a>\n  )\n};\n\nconst ImageContent = ({srcLg, srcSm, label, date}) => {\n  if (srcSm == null || srcLg == null) {\n    return (<div></div>)\n  }\n  else {\n    const formatted = date;\n    return (\n      <div>\n        <img src={srcSm} href={srcLg} alt={label} />\n        <div id=\"date\">{formatted}</div>\n      </div>\n    )\n  }\n};\n\nconst Sound = ({s3rsc, place, src}) => {\n  if (src == null) {\n    return <div></div>\n  }\n  else {\n    const url = s3rsc(`${place}/aud/${src}`);\n    return (\n      <audio controls><source src={url} type=\"audio/mpeg\"/>Your browser does not support audio!</audio>\n    )\n  }\n};\n\nexport {paintMarker};","import React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport './MapStyleControl.scss';\n\nconst MapStyleControl = ({options, setStyleCb}) => {\n\n    const [state, setState] = useState(\"closed\");\n    const [style, setStyle] = useState(options[0].url);\n\n    useEffect(() => setStyleCb(style), [style]);\n\n    function toggle() {\n        if (state === \"open\") {setState(\"closed\");} \n        else {setState(\"open\");}\n    }\n\n    const label = `${state === \"open\" ? \"Close\" : \"Open\"} layer style menu.`;\n\n    function styleLabel(name) {\n        return `Set map style to ${name}`;\n    }\n\n    return (\n        <div id=\"styles\" className={state}>\n            <div className=\"mapboxgl-ctrl mapboxgl-ctrl-group\">\n                <button className=\"mapboxgl-ctrl-icon\" onClick={toggle} title={label} aria-label={label}><span className=\"material-icons\">layers</span></button>\n            </div>\n            <ol>{options.map(({name, url}) => \n                <div key={name}>\n                    <li className={style === url ? \"selected\" : \"\"} onClick={() => setStyle(url)} title={styleLabel(name)} aria-label={styleLabel(name)} >{name}</li>\n                </div>\n            )}</ol>\n        </div>\n    )\n};\n\nclass MapBoxControl {\n    constructor(options) {\n        this.container = document.createElement('div');\n        this.container.className = 'mapboxgl-ctrl';\n        this.component = (<MapStyleControl options={options} setStyleCb={(url) => this.map.setStyle(url)} />);\n    }\n  \n    onAdd(map) {\n        this.map = map;\n        this.render();\n        return this.container;\n    }\n  \n    onRemove() {\n        this.container.parentNode.removeChild(this.container);\n        this.map = undefined;\n    }\n  \n    render() {\n        ReactDOM.render(this.component, this.container);\n    }\n  }\n\nexport default MapBoxControl;\n","let _ = require('underscore');\nlet _cache = {};\nlet _filter_local_places = (p) => window.location.host === \"localhost:3000\" || !p.local;\n\nconst s3 = ({s3}) => {\n\n  const s3rsc = where => `${s3.bucketUrl}/gps/s3/${where}?rev=${(new Date()).getTime()}`;\n\n  const fetchPlaces = () =>\n    _fetchJSON(\"all_rivers\")\n      .then(({places}) => {\n        const dat = _.chain(places)\n          .filter(_filter_local_places)\n          .sortBy(\"disp\")\n          .map((p,i) => _.extend(p, {i}))\n          .reduce(((acc, {disp, id, i}) => _.extend(acc, {[id]:{disp, i, loaded:false}})), {})\n          .value();\n        return Promise.resolve(dat);\n      });\n\n  const loadPlace = (place, paintData) => {\n    if (place != null && _cache[place] == null) {\n      return _fetchJSON(`${place}/info`)\n        .then(json => {\n            _cache[place] = json;\n            _.each(json.layers, layer => \n              fetch(s3rsc(`${place}/geojson/${layer}`))\n                .then((res) => res.json())\n                .then(paintData(layer)));\n            return Promise.resolve({json:json, paint:true});\n        })\n    }\n    else {\n      return Promise.resolve({json:_cache[place], paint:place == null});\n    }\n  };\n\n  const _fetchJSON = which =>\n    fetch(s3rsc(`${which}.json`))\n      .then(res => {\n        if (res.ok) {\n          return(res.json());\n        }\n        else {\n          return Promise.reject(`Unable to fetch ${which}.json`);\n        }\n      });\n  \n  return {s3rsc, fetchPlaces, loadPlace};\n};\n\nexport {s3};","import React, { useRef, useEffect, useState } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport './Map.scss';\nimport Menu from './Menu';\nimport Legend from './Legend';\nimport {paintMarker} from './Marker'\nimport MapStyleControl from './MapStyleControl'\nimport {s3} from './S3';\nlet _ = require('underscore');\n\nconst colorWaterMarker = '#2592ff';\nconst colorNonWaterMarker = '#ff2592';\nconst colorPolyFill = '#ff6c6c';\nconst colorPolyStroke = '#ff6c6c'\nconst colorRiver = '#00bcff';\nconst colorTrack = colorNonWaterMarker;\n\nconst paintPoly = { 'line-color': colorPolyStroke, 'line-width': 1, 'line-opacity':0.85 };\nconst paintTrack = { 'line-color': colorTrack, 'line-width': 2, 'line-opacity':0.6} ;\nconst paintRivers = sm => ({ 'line-color': colorRiver, 'line-width': (sm ? 1 : 2), 'line-opacity': (sm ? 0.6 : 1.0)} );\n\nconst hashToPlace = () => window.location.hash.split(\"#\")[1];\n\nconst Map = ({config}) => {\n  mapboxgl.accessToken = config.map.accessToken;\n  const {s3rsc, loadPlace, fetchPlaces} = s3(config);\n\n  const fetchPlacesRef = useRef(fetchPlaces);\n  const map = useRef(null);\n  const mapStyles = useRef(config.map.mapStyles);\n  const hoveredFtRef = useRef(null), selectedFtRef = useRef(null);\n  const mapContainerRef = useRef(null);\n  const attributionRef = useRef(config.map.attribution);\n  const centerRef = useRef(config.map.center);\n  const zoomRef = useRef(config.map.zoom);\n  const mapData = useRef({});\n  \n  const [places, setPlaces] = useState(null);\n  const [legendVisible, setLegendVisible] = useState(false);\n  const [error, setError] = useState(null);\n  const [modalHtml, setModalHtml] = useState(null);\n  const [desc, setDesc] = useState(null);\n  \n  const paintPlaceRef = useRef((place, initialPlaces) => {\n    const paintData = place => lID0 => data => {\n      if (place == null) return;\n      mapData.current[lID0] = () => {\n        const lID1 = `layer-${place}-${lID0}`;\n        map.current.addSource(lID1, {\n          type: 'geojson',\n          data: data\n        });\n      \n        const kinds = lID0.replace(\".geojson\", \"\").split(\"-\");\n        addPoints(lID1, kinds);\n        addPolys(lID1);\n        addLines(lID1, kinds);\n      }\n      mapData.current[lID0]();\n\n      // Reload this data if map style changes\n      map.current.on('style.load', mapData.current[lID0]);\n    };\n    \n    const addPoints = (lID0, kinds) => {\n      const isWaterMarker = kinds.indexOf(\"cenote\") !== -1 || kinds.indexOf(\"river\") !== -1;\n      const lID1 = `${lID0}-points`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'circle',\n        'source': lID0,\n        'paint': {\n        'circle-radius': 6,\n        'circle-color': (isWaterMarker ? colorWaterMarker : colorNonWaterMarker)\n        },\n        'filter': ['==', '$type', 'Point']\n      });\n      addListeners(lID1);\n    };\n    \n    const addListeners = lID => {\n      map.current.on('mousemove', lID, drawTooltip);\n      map.current.on('click', lID, drawDescription);\n      map.current.on('mouseleave', lID, () => map.current.fire('closeAllPopups'));\n    };\n    \n    const drawDescription = ({lngLat, features}) => {\n      setModalHtml(null);\n      if (features.length === 0 || features[0].layer.type === \"line\" ) return;\n      let content = features[0].properties.description;\n      if (content !== undefined && content.length > 0) {\n        if (features.length === 0 ) return;\n        const ft = features[0];\n        const loc = ft.geometry.type === \"Point\" ? ft.geometry.coordinates : lngLat.wrap();\n        if (content.indexOf('http') === 0) content = `<a href='${content}' target='_blank'>${content}</a>`;\n        setModalHtml({loc, html:content});\n      }\n      else {\n        drawTooltip({lngLat, features});\n      }\n    };\n    \n    const drawTooltip = ({lngLat, features}) => {\n      if (features.length === 0 ) return;\n    \n      if (hoveredFtRef.current != null) {\n        hoveredFtRef.current.remove();\n      }\n      const ft = features[0], name = ft.properties[\"name\"] || ft.properties[\"Name\"];\n      if (name == null || name.length === 0) return;\n      const coord = ft.geometry.type === \"Point\" ? ft.geometry.coordinates : lngLat.wrap();\n      \n      const el = document.createElement('div');\n      el.textContent = name;\n    \n      hoveredFtRef.current = new mapboxgl.Popup({offset: [0, -15]})\n        .setLngLat(coord)\n        .setDOMContent(el)\n        .addTo(map.current);\n    \n      el.parentNode.parentNode.className += ' tip hovered';\n    \n      map.current.on('closeAllPopups', () => { \n        if (hoveredFtRef.current != null) {\n          hoveredFtRef.current.remove();\n        }\n      });\n    };\n    \n    const addPolys = lID0 => {\n      map.current.addLayer({\n        'id':  `${lID0}-outline`,\n        'type': 'line',\n        'source': lID0,\n        'paint': paintPoly,\n        'filter': ['==', '$type', 'Polygon']\n      });\n      const lID1 = `${lID0}-area`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'fill',\n        'source': lID0,\n        'paint': {\n          'fill-color': colorPolyFill,\n          'fill-opacity': 0.1\n        },\n        'filter': ['==', '$type', 'Polygon']\n      });\n      addListeners(lID1);\n    };\n    \n    const addLines = (lID0, kinds) => {\n      const isTrack = kinds.indexOf(\"track\") !== -1;\n      const isSmRiver = kinds.indexOf(\"sm\") !== -1;\n      const lID1 = `${lID0}-lines`;\n      map.current.addLayer({\n        'id': lID1,\n        'type': 'line',\n        'source': lID0,\n        'layout': {\n          'line-join': 'round',\n          'line-cap': 'round'\n        },\n        'paint': (isTrack ? paintTrack : paintRivers(isSmRiver)),\n        'filter': ['==', '$type', 'LineString']\n      });\n      addListeners(lID1);\n    };\n\n    return loadPlace(place, paintData(place))\n      .then(({json, paint}) => {\n        if (paint) {\n          // first time setting places, hash indicates no place in particular\n          if (place == null && initialPlaces != null)\n            setPlaces(initialPlaces);\n          else {\n            // hash indicates a specific place, may be first load or not\n            setPlaces(prev0 => {\n              const prev1 = prev0 || initialPlaces;\n              return ({...prev1, [place]:({...prev1[place], loaded:true})})\n            });\n            if (json != null) _.each(json.locations, paintMarker(s3rsc, map.current, place, setModalHtml));\n          }\n        }\n        if (json == null)\n          setDesc(null);\n        else {\n          const pos = _.findWhere(json.locations, {\"label\":json.center}).loc;\n          map.current.flyTo({center:[pos.lng, pos.lat], zoom: json.zoom});\n          setDesc(json.desc);\n        }\n        setError(null);\n        setLegendVisible(true);\n      })\n      .catch(() => setError(\"That place does not exist.\"))\n    });\n  \n  useEffect(() => {\n    if (modalHtml != null) {\n      const r = 15, s = 2;\n      selectedFtRef.current = new mapboxgl.Popup({offset: [0, r*1.25+s/2]})\n        .setLngLat(modalHtml.loc)\n        .setHTML(`<svg class='tip selected' width='${r*2}' height='${r*2}'><circle fill='${colorTrack}' fill-opacity='0.25' stroke-width='${s}' stroke='${colorTrack}' r='${r}' cx='${r}' cy='${r}'></circle></svg>`)\n        .addTo(map.current);\n    }\n    else if (selectedFtRef.current != null) {\n      selectedFtRef.current.remove();\n    }\n  }, [modalHtml]);\n\n  // Initialize map when component mounts\n  useEffect(() => {\n    if (map.current) return;\n\n    map.current = new mapboxgl.Map({\n        container: mapContainerRef.current,\n        center: centerRef.current,\n        zoom: zoomRef.current,\n        attributionControl: false,\n        projection: 'globe'\n      })\n      .addControl(\n        new mapboxgl.GeolocateControl({\n          positionOptions: {\n          enableHighAccuracy: true\n        },\n        trackUserLocation: true,\n        showUserHeading: true\n        })\n      )\n      .addControl(new mapboxgl.AttributionControl({compact: true, customAttribution: attributionRef.current}))\n      .addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}))\n      .addControl(new mapboxgl.NavigationControl(), 'top-right')\n      .addControl(new MapStyleControl(mapStyles.current), 'top-right')\n      .once('load', () => {\n        fetchPlacesRef.current().then((res) => {\n          if (res == null) setError(\"Could not fetch places.\")\n          else {\n            const doLoad = initialPlaces => {\n              let curr = hashToPlace();\n              paintPlaceRef.current(curr, initialPlaces);\n            }\n            doLoad(res);\n            window.onhashchange = () => doLoad();\n          }\n        });\n      });\n\n    // Clean up on unmount\n    return () => map.current.remove();\n  }, []);\n\n  return (\n    <div>\n      <div id=\"my-controls\">\n        <Menu places={places} />\n        <Legend visible={legendVisible} colorRiver={colorRiver} colorTrack={colorTrack} />\n      </div>\n      <Error message={error} />\n      <Desc html={desc} />\n      <div className='map-container' ref={mapContainerRef} />\n      <Modal html={modalHtml} close={()=>setModalHtml(null)} />\n    </div>\n  );\n};\n\nconst Error = ({message}) => {\n  if (message != null) {\n    return (\n      <div id=\"center-message\">\n        <div id=\"message-container\">\n          <div id=\"message\">{message}</div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Desc = ({html}) => {\n  if (html != null) {\n    return (\n      <div id=\"desc-container\">\n        <div id=\"desc\" dangerouslySetInnerHTML={{ __html: html }}></div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nconst Modal = ({html, close}) => {\n  if (html != null) {\n    return (\n      <div id=\"modal-container\">\n        <div id=\"scroller\">\n          <div id=\"modal\">\n            <span className=\"material-icons close\" onClick={close}>close</span>\n            <div id=\"content\" dangerouslySetInnerHTML={{ __html: html.html }}></div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n  else {\n    return <div></div>\n  }\n};\n\nexport default Map;\n","const config = {\n    site: {\n        title: \"Mel Mitchell-Jackson Adventures\"\n    },\n    s3: {\n        bucketUrl : \"https://melmitchelljacksonart-map.s3.us-east-1.amazonaws.com\"\n    },\n    map : {\n        accessToken : \"pk.eyJ1IjoiZWRvYXJkc2Nob29uZXIiLCJhIjoiY2lxcHR0dG51MDJoZGZxbmhneTB0aW5oOSJ9.RX4c1qW-bwPCptphF_mr_A\",\n        mapStyles : [\n            {\n                \"name\":\"Light\",\n                \"url\":\"mapbox://styles/edoardschooner/cku8yh0id5za818rmtnwt7zzo\"\n            },\n            {\n                \"name\":\"Terrain\",\n                \"url\":\"mapbox://styles/edoardschooner/cjjyezpmd7pn02rlhom56eiwl\"\n            },\n            {\n                \"name\":\"Parks\", \n                \"url\":\"mapbox://styles/edoardschooner/ciqptutzk0046bgm1urgdvwiu\"\n            },\n            {\n                \"name\":\"Satellite\",\n                \"url\":\"mapbox://styles/mapbox/satellite-v9\"\n            }\n        ],\n        center: [-119.509444, 37.229722],\n        zoom: 5,\n        attribution : `Â© Wes Jackson ${new Date().getFullYear()} ~ Love and water are never wasted; they are the efflux of our inner nature`\n    }\n}\n\nexport {config};","import React from 'react';\nimport Map from './Map';\nimport {config} from './Config';\n\nfunction App() {\n  return (\n    <div>\n      <title>{config.site.title}</title>\n      <Map config={config}/>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}